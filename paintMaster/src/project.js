require=function t(e,i,o){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return s(i||t)},l,l.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)s(o[r]);return s}({ActorConst:[function(t,e,i){"use strict";cc._RF.push(e,"8b2e7n1AJVHSIog392Gpqhm","ActorConst");var o=cc.Enum({ST_WAIT:0,ST_WALK:1,ST_RUN:2,ST_ATTACK:3,ST_HURT:4,ST_DIE:5,ST_JUMP:6,ST_DEFEND:7,ST_SQUAT:8,ST_FALL:9,ST_LAND:10,ST_BE_PUSHED:11,ST_WIN:12,ST_LOSE:13,ST_RUN_BE_PUSHED:14,ST_COUNT:15});e.exports={ActState:o,ColDir:{NONE:0,COL_LEFT:-1,COL_RIGHT:1,COL_UP:1,COL_DOWN:-1}},cc._RF.pop()},{}],Actor:[function(t,e,i){"use strict";cc._RF.push(e,"918f3K15mtIO4S1XOY4Bvzf","Actor");var o=t("GlobalUtil"),s=t("ActorConst").ActState,n=t("Dictionary");cc.Class({extends:cc.Component,properties:{curState:0,preState:0,directionIdle:0,directionLeft:-1,directionRight:1,direction:0,faceDirection:1,game:null,map:null,aabb:null,speed:cc.v2(0,0),maxSpeed:cc.v2(2e3,2e3),roleId:0,resId:0,teamColor:o.Color.None,teamId:{default:0,visible:function(){return!1}}},onLoad:function(){this.initX=0,this.initY=0,this.addSpX=0,this.addSpY=0,this.curState=-1,this.preState=-1,this.addSpeedXDic=new n,this.node.zIndex=1,this.isCheckOtherColX=!1,this.runBePushSpX=0,this.isBePushedLeft=!1,this.isBePushedRight=!1,this.maxStepSx=.04*this.maxSpeed.x,this.maxStepSy=.04*this.maxSpeed.y,console.log("onLoad this.name:"+this.name+" onLoad: "+this.initX+" :"+this.initY+" this.maxStepSx: "+this.maxStepSx+" this.maxStepSy:"+this.maxStepSy)},start:function(){var t=cc.find("root");this.game=t.getComponent("Game"),this.map=t.getComponent("Map"),console.log("this.name:"+this.name+" start: "+this.initX+" :"+this.initY)},setSpineSkeletData:function(t){this.spineAnim&&this.spineAnim.setSkeletonData(t)},setState:function(t){this.preState=this.curState,this.curState=t,this.preState===s.ST_BE_PUSHED&&t!=s.ST_BE_PUSHED&&(this.isBePushedRight=!1,this.isBePushedLeft=!1,this.resetAddSpeedX())},autoFaceTo:function(){this.faceDirection==this.directionLeft&&this.node.scaleX>0?this.node.scaleX=this.node.scaleX*this.faceDirection:this.faceDirection==this.directionRight&&this.node.scaleX<0&&(this.node.scaleX=Math.abs(this.node.scaleX))},setAddSpX:function(t,e){this.addSpeedXDic.containsKey(t)?this.addSpeedXDic.set(t,e):this.addSpeedXDic.add(t,e)},setAddSpY:function(t){this.addSpY=t},getSpeedX:function(){for(var t=this.addSpeedXDic.keys(),e=0,i=0;i<t.length;i++)e+=this.addSpeedXDic.find(t[i]);return this.speed.x+e},getAddSpeedX:function(){for(var t=this.addSpeedXDic.keys(),e=0,i=0;i<t.length;i++)e+=this.addSpeedXDic.find(t[i]);return e},resetAddSpeedX:function(){this.addSpeedXDic.count>0&&this.addSpeedXDic.clear()},getSpeedY:function(){return this.speed.y+this.addSpY},setInitPos:function(t,e){this.initX=t,this.initY=e,this.setPos(t,e)},initPos:function(){this.setPos(this.initX,this.initY)},setPos:function(t,e){this.node.setPosition(t,e)},isJump:function(){return this.curState===s.ST_JUMP||this.curState===s.ST_FALL||this.curState===s.ST_LAND},isMoveOrBePushed:function(){return this.curState===s.ST_RUN||this.curState===s.ST_WAIT||this.curState===s.ST_WALK||this.curState===s.ST_BE_PUSHED},isMove:function(){return this.curState===s.ST_RUN||this.curState===s.ST_WALK},isWait:function(){return this.curState===s.ST_WAIT||this.curState===s.ST_BE_PUSHED},isYDiff:function(t){return Math.abs(this.node.y-t.node.y)>=10},correctStepSx:function(t){return Math.abs(t)>this.maxStepSx&&(t=t>0?this.maxStepSx:-this.maxStepSx),t},correctStepSy:function(t){return Math.abs(t)>this.maxStepSy&&(t=t>0?this.maxStepSy:-this.maxStepSy),t},correctPos:function(){if(this.aabb){var t=this.map.mapMinX+this.aabb.width/2,e=this.map.mapMaxX-this.aabb.width/2,i=this.map.mapMinY;this.node.x<t?this.node.x=t:this.node.x>e&&(this.node.x=e),this.node.y<i&&(this.node.y=i)}else{var o=this.map.mapMinX,s=this.map.mapMaxX,n=this.map.mapMinY;this.node.x<o?this.node.x=this.initX:this.node.x>s&&(this.node.x=this.initX),this.node.y<n&&(this.node.y=this.initY)}},setColor:function(t){switch(t){case o.Color.Pink:this.node.color=cc.Color.RED;break;case o.Color.Blue:this.node.color=cc.Color.BLUE;break;case o.Color.Green:this.node.color=cc.Color.GREEN;break;case o.Color.Yellow:this.node.color=cc.Color.YELLOW}}}),cc._RF.pop()},{ActorConst:"ActorConst",Dictionary:"Dictionary",GlobalUtil:"GlobalUtil"}],AppStart:[function(t,e,i){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","AppStart");t("csvjson");var o=t("ActorConst").ColDir;cc.Class({extends:cc.Component,properties:{},onLoad:function(){console.log("initMgr."),function(){cc.vv={},cc.vv.net=t("Net");var e=t("GameNetMgr");cc.vv.gameNetMgr=new e,cc.vv.gameNetMgr.initHandlers();var i=t("AudioMgr");cc.vv.audioMgr=new i,cc.vv.audioMgr.init();var o=t("ServerTime");cc.vv.serverTime=new o;var s=t("YYSdk");cc.vv.yySdk=new s;var n=t("GlobalConfig");cc.vv.globalConfig=new n}(),console.log("ColDir.COL_LEFT: "+o.COL_LEFT),console.log("ColDir.COL_RIGHT: "+o.COL_RIGHT),console.log("ColDir.COL_UP: "+o.COL_UP),console.log("ColDir.COL_DOWN: "+o.COL_DOWN),this.pre=Date.now(),this.startPos=null,this.movePos=null,this.moveDis=cc.v2(0,0)},_touchStartEvent:function(t){this.startPos=this.node.convertToNodeSpaceAR(t.getLocation()),console.log("this.startPos: "+this.startPos)},_touchMoveEvent:function(t){this.movePos=this.node.convertToNodeSpaceAR(t.getLocation()),console.log("this.movePos: "+this.movePos),this.moveDis.x=this.movePos.x-this.startPos.x,this.moveDis.y=this.movePos.y-this.startPos.y;this.moveDis.mag()},autoSynActorPos1:function(t){cc.find("CameraContainer").active=!0},autoSynActorPos2:function(){this.now=Date.now(),console.log("setInterval dt: "+(this.now-this.pre)),this.pre=this.now},start:function(){},onDestroy:function(){}}),cc._RF.pop()},{ActorConst:"ActorConst",AudioMgr:"AudioMgr",GameNetMgr:"GameNetMgr",GlobalConfig:"GlobalConfig",Net:"Net",ServerTime:"ServerTime",YYSdk:"YYSdk",csvjson:"csvjson"}],AudioMgr:[function(t,e,i){"use strict";cc._RF.push(e,"2dcecDLY8BJKb1TF6PXvcYf","AudioMgr"),cc.Class({extends:cc.Component,properties:{bgmVolume:1,sfxVolume:1,bgmAudioID:-1,isPlayBGM:!0,isPlaySFX:!0},init:function(){var t;null!=(t=cc.sys.localStorage.getItem("bgmVolume"))&&(this.bgmVolume=parseFloat(t)),null!=(t=cc.sys.localStorage.getItem("sfxVolume"))&&(this.sfxVolume=parseFloat(t)),cc.game.on(cc.game.EVENT_HIDE,function(){console.log("cc.audioEngine.pauseAll"),cc.audioEngine.pauseAll()}),cc.game.on(cc.game.EVENT_SHOW,function(){console.log("cc.audioEngine.resumeAll"),cc.audioEngine.resumeAll()})},playBGM:function(t){this.isPlayBGM&&(this.bgmAudioID>=0&&cc.audioEngine.stop(this.bgmAudioID),this.bgmAudioID=cc.audioEngine.play(t,!0,this.bgmVolume))},stopBGM:function(){this.bgmAudioID>=0&&cc.audioEngine.stop(this.bgmAudioID),this.bgmAudioID=-1},playSFX:function(t){if(this.isPlaySFX&&this.sfxVolume>0)cc.audioEngine.play(t,!1,this.sfxVolume)},setSFXVolume:function(t){this.sfxVolume!=t&&(cc.sys.localStorage.setItem("sfxVolume",t),this.sfxVolume=t)},setBGMVolume:function(t){this.bgmAudioID>=0&&(t>0?cc.audioEngine.resume(this.bgmAudioID):cc.audioEngine.pause(this.bgmAudioID)),this.bgmVolume!=t&&(cc.sys.localStorage.setItem("bgmVolume",t),this.bgmVolume=t,cc.audioEngine.setVolume(this.bgmAudioID,t))},pauseAll:function(){cc.audioEngine.pauseAll()},resumeAll:function(){cc.audioEngine.resumeAll()}}),cc._RF.pop()},{}],BrickColor:[function(t,e,i){"use strict";cc._RF.push(e,"f316em6ETpFPauKWuqHSpVW","BrickColor");var o=t("GlobalUtil"),s=t("ActorConst").ActState,n=o.GridType;cc.Class({extends:cc.Component,properties:{birckType:o.GridType.None,brickColor:o.Color.None,gridId:0,BrickN:{default:"zuankuai",displayName:"普通砖块"},BrickBlue:{default:"zuankuai1",displayName:"蓝色砖块"},BrickPink:{default:"zuankuai2",displayName:"粉色砖块"},BrickGreen:{default:"zuankuai3",displayName:"绿色砖块"},BrickYellow:{default:"zuankuai4",displayName:"黄色砖块"}},start:function(){this.hero=null,this.colliderList=[],this.sprite=this.node.getChildByName("sprite").getComponent(cc.Sprite),this.isPalyAnim=!1},initBrickType:function(t){switch(this.birckType=t,this.birckType){case n.Color:this.birckColBottomAnim=this.node.getChildByName("zuan_up").getComponent(cc.Animation),this.birckColUpAnim=this.node.getChildByName("zuan").getComponent(cc.Animation),this.birckPlayerAnim=this.node.getChildByName("zuan_guang").getComponent(cc.Animation),this.birckColBottomAnim.on("finished",this.onBottomFinished,this),this.birckColUpAnim.on("finished",this.onUpFinished,this),this.birckPlayerAnim.on("finished",this.onOtherFinished,this);break;case n.ColorNoAnim:case n.NoColor:case n.LT:case n.RT:}},onUpLastFrame:function(){},onUpFinished:function(){this.sprite.node.active=!0,this.isPalyAnim=!1,this.birckColBottomAnim.node.active=!1},onBotomLastFrame:function(){},onBottomFinished:function(){this.sprite.node.active=!0,this.isPalyAnim=!1,this.birckColBottomAnim.node.active=!1},onOtherFinished:function(){this.birckPlayerAnim.node.active=!1},otherAnimPlay:function(){this.birckPlayerAnim&&(this.birckPlayerAnim.node.active=!0,this.birckPlayerAnim.play())},handleConllsion:function(t,e){var i=t.world.aabb,o=t.world.preAabb.clone(),s=e.world.aabb,n=e.world.preAabb.clone();n.y=s.y,o.y=i.y,cc.vv.audioMgr.playSFX(cc.vv.resManager.runAudio),o.yMax<n.yMax?(this.sprite.node.active=!1,this.birckColBottomAnim.node.active=!0,this.birckColBottomAnim.play(),this.isPalyAnim=!0):o.yMin>n.yMin&&(this.sprite.node.active=!1,this.birckColUpAnim.node.active=!0,this.birckColUpAnim.play(),this.isPalyAnim=!0)},onCollisionEnter:function(t,e){if(t.tag===o.CollideType.Hero){if(console.log("Birkck onCollisionEnter"),this.hero&&this.hero.game&&!this.hero.game.isStart())return;0==this.isPalyAnim&&this.birckType===n.Color&&this.handleConllsion(t,e);var i=this;this.hero=t.node.getComponent("HeroControl"),this.brickColor!=o.Color.Blue&&this.hero.curState!=s.ST_BE_PUSHED&&setTimeout(function(){cc.vv.gameNetMgr.sendBrickCollideEnter(i.gridId)},170)}this.colliderList.push(t)},onCollisionStay:function(t,e){1==this.colliderList.length&&this.colliderList[0].tag===o.CollideType.Hero&&this.brickColor!=o.Color.Blue&&cc.vv.gameNetMgr.sendBrickCollideEnter(this.gridId)},onCollisionExit:function(t,e){o.removeByValue(this.colliderList,t)},setColor:function(t,e){switch(this.brickColor=t,this.brickColor){case o.Color.Pink:this.sprite.spriteFrame=cc.vv.resManager.getSpriteFrameByName(this.BrickPink),e&&this.otherAnimPlay();break;case o.Color.Blue:this.sprite.spriteFrame=cc.vv.resManager.getSpriteFrameByName(this.BrickBlue),e&&this.otherAnimPlay();break;case o.Color.Green:this.sprite.spriteFrame=cc.vv.resManager.getSpriteFrameByName(this.BrickGreen),e&&this.otherAnimPlay();break;case o.Color.Yellow:this.sprite.spriteFrame=cc.vv.resManager.getSpriteFrameByName(this.BrickYellow),e&&this.otherAnimPlay()}}}),cc._RF.pop()},{ActorConst:"ActorConst",GlobalUtil:"GlobalUtil"}],CameraControl:[function(t,e,i){"use strict";cc._RF.push(e,"d1e93YcLzhOiohXX6bHj9ay","CameraControl"),cc.Class({extends:cc.Component,properties:{target:{default:null,type:cc.Node,visible:function(){return!1}},shakeCenterTarget:{default:null,type:cc.Node},camera:cc.Camera,anim:cc.Animation,jumpZoom:!1,centerAtStart:!1,smoothFollow:!1,followX:{default:0,visible:function(){return this.smoothFollow}},followY:{default:0,visible:function(){return this.smoothFollow}},minFollowDist:{default:0,visible:function(){return this.smoothFollow}},followRatio:{default:0,visible:function(){return this.smoothFollow}},overview:!1,overviewTargets:{default:[],type:[cc.Node],visible:function(){return this.overview}},overviewMargin:{default:0,visible:function(){return this.overview}},speedZoom:!1,zoomInSpeed:{default:0,visible:function(){return this.speedZoom}},zoomOutSpeed:{default:0,visible:function(){return this.speedZoom}},canShake:!1,shakeDuration:{default:0,visible:function(){return this.canShake}},pointerPan:!1,pointerXMult:{default:0,visible:function(){return this.pointerPan}},pointerYMult:{default:0,visible:function(){return this.pointerPan}},useBoundaries:!1,topBound:{default:0,visible:function(){return this.useBoundaries}},bottomBound:{default:0,visible:function(){return this.useBoundaries}},leftBound:{default:0,visible:function(){return this.useBoundaries}},rightBound:{default:0,visible:function(){return this.useBoundaries}}},onLoad:function(){this.startFollow=!1,this.visibleSize=cc.view.getVisibleSize(),this.initZoomRatio=this.camera.zoomRatio,this.centerAtStart&&(this.node.position=this.shakeCenterTarget.convertToWorldSpaceAR(cc.Vec2.ZERO)),this.previousPos=this.node.position,this.overview&&(this.jumpZoom=!1,this.speedZoom=!1),this.speedZoom&&(this.jumpZoom=!1),this.isUpdate=!1,this.tDelta=0,this.isZoomInFinished=!1,this.zoomInCallBack=null},onEnable:function(){cc.director.getPhysicsManager().attachDebugDrawToCamera(this.camera)},onDisable:function(){cc.director.getPhysicsManager().detachDebugDrawFromCamera(this.camera)},setCameraTarget:function(t){this.shakeCamera(),this.target=t},addZoomInCallBack:function(t){this.zoomInCallBack=t},zoomIn:function(t){this.tDelta+=.08,this.tDelta>=1&&(!1===this.isZoomInFinished&&(this.zoomInCallBack&&this.zoomInCallBack(),this.isZoomInFinished=!0,console.log("this.camera.zoomRatio: "+this.camera.zoomRatio)),this.tDelta=1),this.camera.zoomRatio=cc.lerp(this.camera.zoomRatio,t,this.tDelta)},lateUpdate:function(t){if(this.isUpdate){var e=void 0;if(this.overview?e=this.target.parent.convertToWorldSpaceAR(this.getOverviewTargetsMidpoint()):(e=this.target.parent.convertToWorldSpaceAR(this.target.position)).y=e.y+30,this.smoothFollow?((Math.abs(e.x-this.node.x)>=this.followX||Math.abs(e.y-this.node.y)>=this.followY)&&(this.startFollow=!0),this.startFollow&&(this.node.position=this.node.position.lerp(e,this.followRatio),cc.pDistance(e,this.node.position)<=this.minFollowDist&&(this.startFollow=!1))):this.node.position=this.node.parent.convertToNodeSpaceAR(e),this.zoomIn(2.5),this.speedZoom){var i=Math.abs(this.previousPos.x-e.x)/t,o=0;i>this.zoomOutSpeed?(o=1-(i-this.zoomOutSpeed)/(this.zoomInSpeed-this.zoomOutSpeed),this.camera.zoomRatio=cc.lerp(this.camera.zoomRatio,o,.02)):this.camera.zoomRatio=cc.lerp(this.camera.zoomRatio,this.initZoomRatio,.02)}if(this.previousPos=e,this.jumpZoom){var s=e.y/cc.winSize.height;this.camera.zoomRatio=1+.35*(.6-s)}if(this.useBoundaries){var n=this.visibleSize.width/2/this.camera.zoomRatio,r=this.visibleSize.height/2/this.camera.zoomRatio,a=this.node.x-n,h=this.node.x+n,c=this.node.y-r,l=this.node.y+r;a<this.leftBound&&(this.node.x=this.leftBound+n),c<this.bottomBound&&(this.node.y=this.bottomBound+r),h>this.rightBound&&(this.node.x=this.rightBound-n),l>this.topBound&&(this.node.y=this.topBound-r)}}},getOverviewTargetsMidpoint:function(){for(var t=cc.p(0,0),e=99999,i=99999,o=-99999,s=-99999,n=0;n<this.overviewTargets.length;++n){var r=this.overviewTargets[n];o=r.x>o?r.x:o,e=r.x<e?r.x:e,s=r.y>s?r.y:s,i=r.y<i?r.y:i}o+=this.overviewMargin,e-=this.overviewMargin,s+=this.overviewMargin,i-=this.overviewMargin;var a=Math.abs(o-e),h=Math.abs(s-i);t=cc.p(e+a/2,i+h/2);var c=Math.max(a/this.visibleSize.width,h/this.visibleSize.height);return this.camera.zoomRatio=1/c,t},shakeCamera:function(){if(this.canShake){this.anim.play("shake");var t=this;setTimeout(function(){t.stopShake()},1e3*this.shakeDuration)}},stopShake:function(){this.isUpdate=!0,this.anim.stop(),this.camera.node.position=cc.p(0,0)}}),cc._RF.pop()},{}],DataStream:[function(t,e,i){"use strict";cc._RF.push(e,"c5714E6Fj1B271hYI5+U8uG","DataStream");var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function t(e,i,s){this._byteOffset=i||0,e instanceof ArrayBuffer?this.buffer=e:"object"==(void 0===e?"undefined":o(e))?(this.dataView=e,i&&(this._byteOffset+=i)):this.buffer=new ArrayBuffer(e||1),this.position=0,this.endianness=null==s?t.LITTLE_ENDIAN:s};s.prototype={},void 0===Uint8Array.prototype.BYTES_PER_ELEMENT&&(Uint8Array.prototype.BYTES_PER_ELEMENT=Uint8Array.BYTES_PER_ELEMENT,Int8Array.prototype.BYTES_PER_ELEMENT=Int8Array.BYTES_PER_ELEMENT,Uint8ClampedArray.prototype.BYTES_PER_ELEMENT=Uint8ClampedArray.BYTES_PER_ELEMENT,Uint16Array.prototype.BYTES_PER_ELEMENT=Uint16Array.BYTES_PER_ELEMENT,Int16Array.prototype.BYTES_PER_ELEMENT=Int16Array.BYTES_PER_ELEMENT,Uint32Array.prototype.BYTES_PER_ELEMENT=Uint32Array.BYTES_PER_ELEMENT,Int32Array.prototype.BYTES_PER_ELEMENT=Int32Array.BYTES_PER_ELEMENT,Float64Array.prototype.BYTES_PER_ELEMENT=Float64Array.BYTES_PER_ELEMENT),s.prototype.save=function(t){var e=new Blob(this.buffer),i=window.webkitURL||window.URL;if(!i||!i.createObjectURL)throw"DataStream.save: Can't create object URL.";var o=i.createObjectURL(e),s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download",t),s.click(),i.revokeObjectURL(o)},s.BIG_ENDIAN=!1,s.LITTLE_ENDIAN=!0,s.prototype._dynamicSize=!0,Object.defineProperty(s.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),s.prototype._byteLength=0,Object.defineProperty(s.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),s.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i)e>this._byteLength&&(this._byteLength=e);else{for(i<1&&(i=1);e>i;)i*=2;var o=new ArrayBuffer(i),s=new Uint8Array(this._buffer);new Uint8Array(o,0,s.length).set(s),this.buffer=o,this._byteLength=e}}},s.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length);e.set(i),this.buffer=t}},s.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},s.prototype.isEof=function(){return this.position>=this.byteLength},s.prototype.mapInt32Array=function(t,e){this._realloc(4*t);var i=new Int32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},s.prototype.mapInt16Array=function(t,e){this._realloc(2*t);var i=new Int16Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},s.prototype.mapInt8Array=function(t){this._realloc(1*t);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},s.prototype.mapUint32Array=function(t,e){this._realloc(4*t);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},s.prototype.mapUint16Array=function(t,e){this._realloc(2*t);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=2*t,i},s.prototype.mapUint8Array=function(t){this._realloc(1*t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},s.prototype.mapFloat64Array=function(t,e){this._realloc(8*t);var i=new Float64Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=8*t,i},s.prototype.mapFloat32Array=function(t,e){this._realloc(4*t);var i=new Float32Array(this._buffer,this.byteOffset+this.position,t);return s.arrayToNative(i,null==e?this.endianness:e),this.position+=4*t,i},s.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Int32Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Int16Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return s.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},s.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Uint32Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Uint16Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return s.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},s.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var i=new Float64Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Float32Array(t);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},s.prototype.writeInt32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Int32Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)},s.prototype.writeInt16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Int16Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)},s.prototype.writeInt8Array=function(t){if(this._realloc(1*t.length),t instanceof Int8Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},s.prototype.writeUint32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Uint32Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)},s.prototype.writeUint16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Uint16Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)},s.prototype.writeUint8Array=function(t){if(this._realloc(1*t.length),t instanceof Uint8Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},s.prototype.writeFloat64Array=function(t,e){if(this._realloc(8*t.length),t instanceof Float64Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)},s.prototype.writeFloat32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Float32Array&&(this.byteOffset+this.position)%t.BYTES_PER_ELEMENT==0)s.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,t.byteOffset,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)},s.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,e},s.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,e},s.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},s.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,e},s.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,e},s.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},s.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,e},s.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,e},s.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,null==e?this.endianness:e),this.position+=4},s.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,null==e?this.endianness:e),this.position+=2},s.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},s.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,null==e?this.endianness:e),this.position+=4},s.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,null==e?this.endianness:e),this.position+=2},s.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},s.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,null==e?this.endianness:e),this.position+=4},s.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,null==e?this.endianness:e),this.position+=8},s.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,s.memcpy=function(t,e,i,o,s){var n=new Uint8Array(t,e,s),r=new Uint8Array(i,o,s);n.set(r)},s.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},s.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},s.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var o=i+t.BYTES_PER_ELEMENT-1,s=i;o>s;o--,s++){var n=e[s];e[s]=e[o],e[o]=n}return t},s.createStringFromArray=function(t){for(var e=[],i=0;i<t.length;i+=32768)e.push(String.fromCharCode.apply(null,t.subarray(i,i+32768)));return e.join("")},s.prototype.failurePosition=0,s.prototype.readStruct=function(t){for(var e,i,o={},s=this.position,n=0;n<t.length;n+=2){if(e=t[n+1],null==(i=this.readType(e,o)))return 0==this.failurePosition&&(this.failurePosition=this.position),this.position=s,null;o[t[n]]=i}return o},s.prototype.readUCS2String=function(t,e){return s.createStringFromArray(this.readUint16Array(t,e))},s.prototype.writeUCS2String=function(t,e,i){null==i&&(i=t.length);for(var o=0;o<t.length&&o<i;o++)this.writeUint16(t.charCodeAt(o),e);for(;o<i;o++)this.writeUint16(0)},s.prototype.readString=function(t,e){if(null==e||"ASCII"==e)return s.createStringFromArray(this.mapUint8Array(null==t?this.byteLength-this.position:t));console.log("not implement")},s.prototype.writeString=function(t,e,i){if(null==e||"ASCII"==e)if(null!=i){var o=0,s=Math.min(t.length,i);for(o=0;o<s;o++)this.writeUint8(t.charCodeAt(o));for(;o<i;o++)this.writeUint8(0)}else for(o=0;o<t.length;o++)this.writeUint8(t.charCodeAt(o));else console.log("not implement")},s.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),o=e;null!=t&&(o=Math.min(t,e));for(var n=0;n<o&&0!=i[n];n++);var r=s.createStringFromArray(this.mapUint8Array(n));return null!=t?this.position+=o-n:n!=e&&(this.position+=1),r},s.prototype.writeCString=function(t,e){if(null!=e){var i=0,o=Math.min(t.length,e);for(i=0;i<o;i++)this.writeUint8(t.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else{for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));this.writeUint8(0)}},s.prototype.readType=function(t,e){if("function"==typeof t)return t(this,e);if(!("object"!=(void 0===t?"undefined":o(t))||t instanceof Array))return t.get(this,e);if(t instanceof Array&&3!=t.length)return this.readStruct(t,e);var i,n=null,r=null,a="ASCII",h=this.position;"string"==typeof t&&/:/.test(t)&&(t=(i=t.split(":"))[0],r=null!=e[c=i[1]]?parseInt(e[c]):parseInt(i[1]));"string"==typeof t&&/,/.test(t)&&(t=(i=t.split(","))[0],a=parseInt(i[1]));switch(t){case"uint8":n=this.readUint8();break;case"int8":n=this.readInt8();break;case"uint16":n=this.readUint16(this.endianness);break;case"int16":n=this.readInt16(this.endianness);break;case"uint32":n=this.readUint32(this.endianness);break;case"int32":n=this.readInt32(this.endianness);break;case"float32":n=this.readFloat32(this.endianness);break;case"float64":n=this.readFloat64(this.endianness);break;case"uint16be":n=this.readUint16(s.BIG_ENDIAN);break;case"int16be":n=this.readInt16(s.BIG_ENDIAN);break;case"uint32be":n=this.readUint32(s.BIG_ENDIAN);break;case"int32be":n=this.readInt32(s.BIG_ENDIAN);break;case"float32be":n=this.readFloat32(s.BIG_ENDIAN);break;case"float64be":n=this.readFloat64(s.BIG_ENDIAN);break;case"uint16le":n=this.readUint16(s.LITTLE_ENDIAN);break;case"int16le":n=this.readInt16(s.LITTLE_ENDIAN);break;case"uint32le":n=this.readUint32(s.LITTLE_ENDIAN);break;case"int32le":n=this.readInt32(s.LITTLE_ENDIAN);break;case"float32le":n=this.readFloat32(s.LITTLE_ENDIAN);break;case"float64le":n=this.readFloat64(s.LITTLE_ENDIAN);break;case"cstring":n=this.readCString(r);break;case"string":n=this.readString(r,a);break;case"u16string":n=this.readUCS2String(r,this.endianness);break;case"u16stringle":n=this.readUCS2String(r,s.LITTLE_ENDIAN);break;case"u16stringbe":n=this.readUCS2String(r,s.BIG_ENDIAN);break;default:if(3==t.length){var c,l=t[1],d=0;if(d="function"==typeof(c=t[2])?c(e,this,t):"string"==typeof c&&null!=e[c]?parseInt(e[c]):parseInt(c),"string"==typeof l){var u=l.replace(/(le|be)$/,""),p=null;switch(/le$/.test(l)?p=s.LITTLE_ENDIAN:/be$/.test(l)&&(p=s.BIG_ENDIAN),"*"==c&&(d=null),u){case"uint8":n=this.readUint8Array(d);break;case"uint16":n=this.readUint16Array(d,p);break;case"uint32":n=this.readUint32Array(d,p);break;case"int8":n=this.readInt8Array(d);break;case"int16":n=this.readInt16Array(d,p);break;case"int32":n=this.readInt32Array(d,p);break;case"float32":n=this.readFloat32Array(d,p);break;case"float64":n=this.readFloat64Array(d,p);break;case"cstring":case"utf16string":case"string":if(null==d)for(n=[];!this.isEof();){if(null==(g=this.readType(l,e)))break;n.push(g)}else{n=new Array(d);for(var m=0;m<d;m++)n[m]=this.readType(l,e)}}}else if("*"==c)for(n=[],this.buffer;;){var f=this.position;try{var y=this.readType(l,e);if(null==y){this.position=f;break}n.push(y)}catch(t){this.position=f;break}}else{n=new Array(d);for(m=0;m<d;m++){var g;if(null==(g=this.readType(l,e)))return null;n[m]=g}}break}}return null!=r&&(this.position=h+r),n},s.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var o=t[i+1];this.writeType(o,e[t[i]],e)}},s.prototype.writeType=function(t,e,i){if("function"==typeof t)return t(this,e);if("object"==(void 0===t?"undefined":o(t))&&!(t instanceof Array))return t.set(this,e,i);var n,r=null,a="ASCII",h=this.position;"string"==typeof t&&/:/.test(t)&&(t=(n=t.split(":"))[0],r=parseInt(n[1]));"string"==typeof t&&/,/.test(t)&&(t=(n=t.split(","))[0],a=parseInt(n[1]));switch(t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,s.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,s.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,s.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,s.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,s.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,s.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,s.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,s.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,s.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,s.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,s.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,s.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,r);break;case"string":this.writeString(e,a,r);break;case"u16string":this.writeUCS2String(e,this.endianness,r);break;case"u16stringle":this.writeUCS2String(e,s.LITTLE_ENDIAN,r);break;case"u16stringbe":this.writeUCS2String(e,s.BIG_ENDIAN,r);break;default:if(3==t.length){for(var c=t[1],l=0;l<e.length;l++)this.writeType(c,e[l]);break}this.writeStruct(t,e)}null!=r&&(this.position=h,this._realloc(r),this.position=h+r)},"function"==typeof define&&define.amd&&define("DataStream",[],function(){return s}),"object"===(void 0===e?"undefined":o(e))&&e&&e.exports&&(e.exports=s),cc._RF.pop()},{}],Dictionary:[function(t,e,i){"use strict";cc._RF.push(e,"d5b82SG+WhGR5Vr/i1/hF2g","Dictionary");var o,s,n,r,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.keys||(Object.keys=(o=Object.prototype.hasOwnProperty,s=!{toString:null}.propertyIsEnumerable("toString"),r=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("object"!==(void 0===t?"undefined":a(t))&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var i in t)o.call(t,i)&&e.push(i);if(s)for(var h=0;h<r;h++)o.call(t,n[h])&&e.push(n[h]);return e}));var h=function(){this.datastore=new Array,this.count=0};(h.prototype={}).add=function(t,e){this.datastore[t]=e,this.count++},h.prototype.set=function(t,e){this.containsKey(t)||this.count++,this.datastore[t]=e},h.prototype.containsKey=function(t){return null!=this.datastore[t]},h.prototype.find=function(t){return this.datastore[t]},h.prototype.remove=function(t){delete this.datastore[t],this.count--},h.prototype.count=function(){return this.count},h.prototype.keys=function(){return Object.keys(this.datastore)},h.prototype.clear=function(){this.count=0,this.datastore.length=0},h.prototype.showAll=function(){for(var t in Object.keys(this.datastore))print(t+"->"+this.datastore[t])},"function"==typeof define&&define.amd&&define("Dictionary",[],function(){return h}),"object"===(void 0===e?"undefined":a(e))&&e&&e.exports&&(e.exports=h),cc._RF.pop()},{}],GameBg:[function(t,e,i){"use strict";cc._RF.push(e,"44a2cm8MUpJ4pH1f05xYD/Z","GameBg"),cc.Class({extends:cc.Component,properties:{zIndex:-1},start:function(){console.log(cc.view.getFrameSize()),console.log(cc.view.getVisibleSize()),console.log(cc.winSize),this.node.width=cc.winSize.width,this.node.height=cc.winSize.height,this.node.x=this.node.width/2,this.node.y=this.node.height/2,this.node.zIndex=this.zIndex}}),cc._RF.pop()},{}],GameConfig:[function(t,e,i){"use strict";cc._RF.push(e,"9609fKmY+NLK5o6dtkd5Q8C","GameConfig"),cc.Class({extends:cc.Component,properties:{UPDATE_ROLE_SCHEDULE_TIME:.1,SYS_OS:"WIN",bgmVolume:1,sfxVolume:1},onLoad:function(){this.SYS_OS=cc.sys.os},start:function(){this.SYS_OS==cc.sys.OS_ANDROID&&(this.bgmVolume=.5,this.sfxVolume=.5),cc.vv.audioMgr.setBGMVolume(this.bgmVolume),cc.vv.audioMgr.setSFXVolume(this.sfxVolume)}}),cc._RF.pop()},{}],GameNetMgr:[function(t,e,i){"use strict";cc._RF.push(e,"bba97S4F1pJwK1jzPgjmmBZ","GameNetMgr");var o=t("GlobalUtil"),s=t("DataStream"),n=t("MathUtil");cc.Class({extends:cc.Component,properties:{roomId:null,gamestate:"",isOver:!1,game:null,netcmd_type_system_q:1,netcmd_type_system_r:2,netcmd_type_paint_q:3,netcmd_type_paint_r:4,netcmd_system_error_code:1,netcmd_system_ping:2,netcmd_system_timer:3,netcmd_system_enter:4,netcmd_system_result:5,netcmd_system_syn_time:7,netcmd_paint_int:1,netcmd_paint_syn_pos:2,netcmd_piant_collide:3,netcmd_piant_settlement:4,isFirstSynTime:!0},reset:function(){this.gamestate=""},clear:function(){null==this.isOver&&(this.roomId=null)},initHandlers:function(){},doHandleMessage:function(t){var e=new s(t),i=e.readUint8(),o=e.readUint8();if(i===this.netcmd_type_system_r)switch(o){case this.netcmd_system_error_code:this.reciveSystemError(e);break;case this.netcmd_system_ping:this.reciveSystemPing(e);break;case this.netcmd_system_timer:this.resciveSystemTimer(e);break;case this.netcmd_system_enter:this.reciveSystemEnter(e);break;case this.netcmd_system_result:this.reciveSystemRResult(e);break;case this.netcmd_system_syn_time:this.reciveSystemSynTime(e)}else if(i===this.netcmd_type_paint_r)switch(o){case this.netcmd_paint_int:this.recivePaintInit(e);break;case this.netcmd_paint_syn_pos:this.reciveSynActorPos(e);break;case this.netcmd_piant_collide:this.reciveBrickColliderEnter(e);break;case this.netcmd_piant_settlement:this.recivePaintSettlement(e)}else console.log("协议错误: cmdType: "+i+" cmdOption: "+o)},reciveSystemError:function(t){var e=t.readUint16();1===e&&(this.game.onPKExceptionFinish(),console.log("服务器验证失败!!!")),console.log("错误码：err_id: "+e)},recivePaintSettlement:function(t){this.game.onPaintSettlement({})},reciveSystemRResult:function(t){console.log("reciveSystemRResult:");var e=t.readUint16(),i=t.readString(e);this.game.onSSystemRResult(i)},resciveSystemTimer:function(t){var e=t.readUint16();e===o.TimerType.PaintStart?this.game.startGame(e):e===o.TimerType.PaintEnd&&(this.game.gameOverStartCount(),console.log("收到游戏结束倒计时"))},sendSystemSynTime:function(t){var e=new ArrayBuffer(4);(t=new s(e)).writeUint8(this.netcmd_type_system_q),t.writeUint8(this.netcmd_system_syn_time),cc.vv.serverTime.refreshSendTime(),cc.vv.net.send(t)},reciveSystemSynTime:function(t){var e=t.readUint32();t.readUint32();this.isFirstSynTime&&(console.log("sendSystemEnter"),this.sendSystemEnter(),this.isFirstSynTime=!1),cc.vv.serverTime.refreshServerTime(1e3*e)},sendAppEnterBackground:function(){},recivePaintInit:function(t){console.log("初始化角色信息");var e={};e.userLength=t.readUint16(),console.log(" obj.userLength : "+e.userLength),e.users=[];for(var i=0;i<e.userLength;i++){var o={},s=t.readUint16();o.uid=t.readString(s),console.log("userInfo.uid : "+o.uid),o.roleId=t.readUint16(),console.log("userInfo.roleId : "+o.roleId),o.color=t.readUint16(),o.init_pos=t.readUint16(),o.teamId=t.readUint16(),e.users.push(o)}this.game.gameInit(e)},reciveSystemEnter:function(t){var e=t.readUint16();console.log(" reciveSystemEnter:  roleId:"+e),this.game.setRoleId(e);var i=this;i.preSynTime=cc.vv.serverTime.getTime(),setInterval(function(){var t=cc.vv.serverTime.getTime(),e=t-i.preSynTime;i.autoSynActorPos(e/1e3),i.preSynTime=t}.bind(this),17),setInterval(function(){i.sendSystemSynTime()},2e3)},sendSystemEnter:function(){var t=String(cc.vv.serverTime.getTime()),e="568bc11c-504c-4be8-9104-0be6b0cc2280";if(null!=this.game.QuerySign()){var i=this.game.QueryPost_data();this.game.printMsg(i),i=decodeURI(i);var n=JSON.parse(i);t=n.player.uid,e=n.roomid}var r=new s;r.writeUint8(this.netcmd_type_system_q),r.writeUint8(this.netcmd_system_enter),console.log("uid.length: "+t.length+" uid:"+t),r.writeUint16(t.length),r.writeString(t),console.log("roomid.length: "+e.length),r.writeUint16(e.length),r.writeString(e),r.writeUint8(o.GameId),cc.vv.net.send(r)},reciveSynActorPos:function(t){var e={};e.roleId=t.readUint16(),e.x=n.trimFloat(t.readFloat32()),e.y=n.trimFloat(t.readFloat32()),e.direction=t.readInt8(),e.state=t.readUint8(),e.vx=n.trimFloat(t.readFloat32()),e.vy=n.trimFloat(t.readFloat32());t.readUint16();e.sTime=t.readString(),this.game.reciveSynActorPos(e)},autoSynActorPos:function(t){this.game.autoSynActorPos(t)},sendSynActorPos:function(t){var e=new ArrayBuffer(14),i=new s(e);i.writeUint8(this.netcmd_type_paint_q),i.writeUint8(this.netcmd_paint_syn_pos),i.writeFloat32(t.x),i.writeFloat32(t.y),i.writeInt8(t.direction),i.writeUint8(t.state),i.writeFloat32(t.vx),i.writeFloat32(t.vy);var o=t.sTime.toString();i.writeUint16(o.length),i.writeString(o),cc.vv.net.send(i)},sendBrickCollideEnter:function(t){var e=new ArrayBuffer(6),i=new s(e);i.writeUint8(this.netcmd_type_paint_q),i.writeUint8(this.netcmd_piant_collide),i.writeUint16(t),cc.vv.net.send(i)},reciveBrickColliderEnter:function(t){var e={};e.roleId=t.readUint16(),e.teamId=t.readUint16(),e.gridId=t.readUint16(),e.score=t.readUint16(),e.otherRoleId=t.readUint16(),e.otherTeamId=t.readUint16(),e.otherScore=t.readUint16(),this.game.reciveBrickColliderEnter(e)},reciveSystemPing:function(t){this.lastRecieveTime=cc.vv.serverTime.getTime(),this.delayMS=this.lastRecieveTime-this.lastSendTime},sendSystemPing:function(){var t=new ArrayBuffer(4),e=new s(t);e.writeUint8(this.netcmd_type_system_q),e.writeUint8(this.netcmd_system_ping),cc.vv.net.send(e),this.lastSendTime=cc.vv.serverTime.getTime()},checkHearBeat:function(){cc.vv.serverTime.getTime()-this.lastRecieveTime>5e3&&console.log("网络心跳异常了。5s没收到")},connectGameServer:function(t){this.dissoveData=null;var e="ws://"+t.ip+":"+t.port;this.game?(this.game.analyseUrlParams(),null!=this.game.QuerySign()?(console.log("connectGameServer : 1"),cc.vv.net.ip=encodeURI(this.game.createWSUrl())):cc.vv.net.ip=e):cc.vv.net.ip=e,console.log(cc.vv.net.ip);var i=this;cc.vv.net.connect(function(){i.sendSystemSynTime(),setInterval(function(){i.sendSystemPing()},1e3),setInterval(function(){i.checkHearBeat()},1e3)},function(){console.log("failed.")})}}),cc._RF.pop()},{DataStream:"DataStream",GlobalUtil:"GlobalUtil",MathUtil:"MathUtil"}],GameUI:[function(t,e,i){"use strict";cc._RF.push(e,"3a0e0ky4+VBq6x98n0jCkMA","GameUI");var o=t("Dictionary");t("GlobalUtil"),t("ResultUI");cc.Class({extends:cc.Component,properties:{},start:function(){var t=cc.find("root");this.game=t.getComponent("Game"),this.playerUINodes=[];var e=cc.find("Player0UI",this.node);this.playerUINodes.push(e),e=cc.find("Player1UI",this.node),this.playerUINodes.push(e),e=cc.find("Player2UI",this.node),this.playerUINodes.push(e),e=cc.find("Player3UI",this.node),this.playerUINodes.push(e),this.beginAnim=this.node.getChildByName("readygo").getComponent(cc.Animation),this.beginAnim.node.active=!1,this.gameOverAnim=this.node.getChildByName("gameover").getComponent(cc.Animation),this.gameOverAnim.node.active=!1,this.spTime=cc.find("TimeUI/Time",this.node).getComponent(cc.Sprite),this.gameTime=60,this.curGameTime=0,this.isGameBeging=!1},initGameUI:function(){if(this.playerUIDic=new o,2===this.game.players.length){this.playerUINodes[1].active=!1,this.playerUINodes[2].active=!1;var t={};t.lbScore=this.playerUINodes[0].getChildByName("Score").getComponent(cc.Label),t.SpPortrait=this.playerUINodes[0].getChildByName("SpPortrait").getComponent(cc.Sprite),t.SpPortrait.spriteFrame=cc.vv.resManager.getPortrait(this.game.players[0].resId),this.playerUIDic.add(this.game.players[0].roleId,t);var e={};e.lbScore=this.playerUINodes[3].getChildByName("Score").getComponent(cc.Label),e.SpPortrait=this.playerUINodes[3].getChildByName("SpPortrait").getComponent(cc.Sprite),e.SpPortrait.spriteFrame=cc.vv.resManager.getPortrait(this.game.players[1].resId),this.playerUIDic.add(this.game.players[1].roleId,e)}else{3===this.game.players.length&&(this.playerUINodes[3].active=!1);for(var i=0;i<this.game.players.length;i++){var s={};s.lbScore=this.playerUINodes[i].getChildByName("Score").getComponent(cc.Label),s.SpPortrait=this.playerUINodes[i].getChildByName("SpPortrait").getComponent(cc.Sprite),s.SpPortrait.spriteFrame=cc.vv.resManager.getPortrait(this.game.players[i].resId),this.playerUIDic.add(this.game.players[i].roleId,s)}}},setScore:function(t,e){this.playerUIDic.find(t).lbScore.string=e},setIcon:function(t,e){},showBeginAnim:function(t){this.beginAnim.node.active=t,t?(this.beginAnim.play("readygo"),console.log("cc.vv.resManager.readyGoAudio:"+cc.vv.resManager.readyGoAudio),cc.vv.audioMgr.playSFX(cc.vv.resManager.readyGoAudio)):(this.beginAnim.stop("readygo"),this.isGameBeging=!0)},showGameOverAnim:function(t){this.gameOverAnim.node.active=t,t?(this.gameOverAnim.play("gameover"),cc.vv.audioMgr.playSFX(cc.vv.resManager.countAudio),setTimeout(function(){cc.vv.audioMgr.playSFX(cc.vv.resManager.gameOverAudio)},5e3)):this.gameOverAnim.stop("gameover")},endGame:function(t){cc.find("Canvas/ResultUI").getComponent("ResultUI").showResult(t)},setShowTime:function(t){this.spTime.fillRange=1-t},update:function(t){this.isGameBeging&&(this.curGameTime<=this.gameTime?(this.curGameTime+=t,this.setShowTime(this.curGameTime/this.gameTime)):(this.setShowTime(1),this.isGameBeging=!1))}}),cc._RF.pop()},{Dictionary:"Dictionary",GlobalUtil:"GlobalUtil",ResultUI:"ResultUI"}],Game_mo:[function(t,e,i){"use strict";cc._RF.push(e,"4d33ewhrTJBYK/3vKsierwY","Game_mo");t("GameUI");var o=t("MathUtil"),s=(t("Player"),t("HeroControl")),n=t("GlobalUtil");cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab,displayName:"玩家"},hero:{default:null,type:s,displayName:"主角"},synSelectedIndex:1,smoothSelIndex:0,lastVelocity:cc.v2(0,0),delay:150,range:20,playerInputPack:[]},onEnable:function(){cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!0,cc.director.getCollisionManager().enabledDrawBoundingBox=!0},onDisable:function(){cc.director.getCollisionManager().enabled=!1,cc.director.getCollisionManager().enabledDebugDraw=!1,cc.director.getCollisionManager().enabledDrawBoundingBox=!1},start:function(){var t=cc.instantiate(this.playerPrefab);t.parent=this.node,this.netPlayer=t.getComponent("Player"),this.netPlayer.setPos(this.hero.node.getPosition().x,this.hero.node.getPosition().y),this.netPlayer.setColor(n.Color.Pink)},update:function(t){var e=!1;if(0===this.synSelectedIndex)e=!0;else if(1===this.synSelectedIndex)if(this.lastState){var i=this.lastState.position.sub(this.hero.node.getPosition()).mag();i=o.trimFloat(i),Math.abs(i)>=1?e=!0:this.lastState.velocity.x==this.hero.speed.x&&this.lastState.velocity.y==this.hero.speed.y&&this.lastState.state==this.hero.curState&&this.lastState.direction==this.hero.direction||(e=!0)}else e=!0;else if(2===this.synSelectedIndex){var s=cc.v2(0,0);if(this.lastState){var n=(cc.vv.serverTime.getTime()-this.lastStateTime)/1e3,r=this.lastState.velocity.mul(n);s.addSelf(this.lastState.position),s.addSelf(r)}s.subSelf(this.hero.node.getPosition()).mag()>5&&(e=!0)}for(e&&this.sendSynActorPos();this.playerInputPack.length>0;){var a=this.playerInputPack.shift();if(console.log("接收网络包 rp.vx:"+a.vx+" rp.vy:"+a.vy+" rp.x: "+a.x+" rp.y:"+a.y+" time:"+cc.vv.serverTime.getTime()+" rp.state:"+a.state),0===this.smoothSelIndex)this.netPlayer.position.x=a.x,this.netPlayer.position.y=a.y,this.netPlayer.direction=a.direction,this.netPlayer.setSpeed(a.vx,a.vy),this.netPlayer.setState(a.state);else if(1===this.smoothSelIndex)this.netPlayer.modify.x=this.netPlayer.node.x-a.x,this.netPlayer.modify.y=this.netPlayer.node.y-a.y,this.netPlayer.modify.mag()>50&&(this.netPlayer.modify.x=0,this.netPlayer.modify.y=0),this.netPlayer.position.x=a.x,this.netPlayer.position.y=a.y,this.netPlayer.direction=a.direction,this.netPlayer.setSpeed(a.vx,a.vy),this.netPlayer.setState(a.state);else if(2===this.smoothSelIndex){var h=5*((cc.vv.serverTime.getTime()-a.sTime)/1e3);h=Math.min(h,.8);var c=cc.v2(a.x,a.y),l=cc.v2(a.vx,a.vy),d=this.netPlayer.position.clone(),u=d.add(this.netPlayer.speed.clone().mul(.1)),p=c.addSelf(l.mul(h)),m=p.sub(l.mul(.1));this.netPlayer.smoothTick=h,this.netPlayer.smoothTime=h,this.netPlayer.A=p.x-3*m.x+3*u.x-d.x,this.netPlayer.B=3*m.x-6*u.x+3*d.x,this.netPlayer.C=3*u.x-3*d.x,this.netPlayer.D=d.x,this.netPlayer.E=p.y-3*m.y+3*u.y-d.y,this.netPlayer.F=3*m.y-6*u.y+3*d.y,this.netPlayer.G=3*u.y-3*d.y,this.netPlayer.H=d.y,this.netPlayer.setSpeed(a.vx,a.vy),this.netPlayer.direction=a.direction,this.netPlayer.setState(a.state)}else 3===this.smoothSelIndex&&this.netPlayer.reciveSynPos(a)}},rand:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},sendSynActorPos:function(){var t={};t.x=o.trimFloat(this.hero.node.getPosition().x),t.y=o.trimFloat(this.hero.node.getPosition().y),t.direction=this.hero.direction,t.state=this.hero.curState,t.vx=o.trimFloat(this.hero.speed.x),t.vy=o.trimFloat(this.hero.speed.y),t.sTime=cc.vv.serverTime.getTime();console.log("sendSynActorPos delayTime:40 data.vx: "+t.vx+" data.vy:"+t.vy+" data.x: "+t.x+" data.y:"+t.y+" data.state:"+t.state);var e=this;setTimeout(function(){e.sendNow(t)},40),this.lastState={},this.lastState.velocity=cc.v2(t.vx,t.vy),this.lastVelocity.x=t.vx,this.lastVelocity.y=t.vy,this.lastState.position=cc.v2(t.x,t.y),this.lastState.direction=t.direction,this.lastState.time=t.sTime,this.lastState.state=t.state,this.lastStateTime=cc.vv.serverTime.getTime()},sendNow:function(t){this.playerInputPack.push(t)}}),cc._RF.pop()},{GameUI:"GameUI",GlobalUtil:"GlobalUtil",HeroControl:"HeroControl",MathUtil:"MathUtil",Player:"Player"}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"d96400vNFFPIpzg48kPuXVc","Game");t("GameUI");var o=t("MathUtil"),s=(t("Player"),t("HeroControl"),t("GlobalUtil")),n=t("ActorConst"),r=t("Dictionary"),a=n.ActState;cc.Class({extends:cc.Component,properties:{joystick:{default:null,type:cc.Node,displayName:"摇杆"},playerPrefab:{default:null,type:cc.Prefab,displayName:"玩家"},heroPrefab:{default:null,type:cc.Prefab,displayName:"主角"},gameBeginBacktime_end:!1,gameStart:!1,send_update_pos_time:0,roleId:0,players:[],hero:null,synSelectedIndex:1,smoothSelIndex:0,lastVelocity:cc.v2(0,0),map:null},onEnable:function(){console.log("game onEnable"),cc.director.getCollisionManager().enabled=!0,this.setDebugDraw(cc.vv.globalConfig.isDebugMode)},onDisable:function(){cc.director.getCollisionManager().enabled=!1,this.setDebugDraw(cc.vv.globalConfig.isDebugMode)},setDebugDraw:function(t){cc.director.getCollisionManager().enabledDebugDraw=t,cc.director.getCollisionManager().enabledDrawBoundingBox=t},onLoad:function(){console.log("Game Load"),this.rolePos=new r;var t={x:320,y:52};this.rolePos.add(1,t),(t={}).x=900,t.y=52,this.rolePos.add(2,t),(t={}).x=320,t.y=342,this.rolePos.add(3,t),(t={}).x=900,t.y=342,this.rolePos.add(4,t),this.winRole=null},start:function(){console.log("Game start"),this.joystickCtrl=this.joystick.getComponent("JoystickNode"),this.gameStart=!1,this.config=this.getComponent("GameConfig"),cc.vv.gameNetMgr.game=this,this.gameUI=cc.find("Canvas/GameUI").getComponent("GameUI"),this.map=this.node.getComponent("Map"),this.winCamera=cc.find("CameraContainer").getComponent("CameraControl"),this.connectGameServer(),window.nativeApp?(window.nativeApp.appEnterBackground=this.appEnterBackground(),window.nativeApp.onPKGameReady=this.onPKGameReady()):cc.vv.audioMgr.playBGM(cc.vv.resManager.bgAudio),this.updateLoadingBarProgress(5),this.registerInputEvent()},registerInputEvent:function(){var t=this;this.joystickCtrl.addJoyStickTouchMoveListener(function(e){t.isStart()&&t.gameBeginBacktime_end&&null!=e&&null!=t.hero&&t.hero.handleKeyPressed(e)}),this.joystickCtrl.addJoyStickTouchEndListener(function(e){t.isStart()&&t.gameBeginBacktime_end&&t.hero&&t.hero.handleKeyReleased(e)})},jumpBtnClick:function(){this.hero&&this.hero.handleKeyPressed(cc.KEY.space)},connectGameServer:function(){var t=cc.find("AppStart").getComponent("NetConfig");cc.vv.netConfig=t;var e=t.getCurNetData();e?(console.log("cc.vv.gameNetMgr.connectGameServer:"),cc.vv.gameNetMgr.connectGameServer(e),this.resetSynActorPosTime()):console.log("ip data is null")},resetSynActorPosTime:function(){this.send_update_pos_time=this.config.UPDATE_ROLE_SCHEDULE_TIME},autoSynActorPos:function(t){if(this.isStart()&&this.hero){if(this.send_update_pos_time<=0){this.resetSynActorPosTime();var e=!1;if(1===this.synSelectedIndex)if(this.lastState){var i=this.lastState.position.sub(this.hero.node.getPosition()).mag();i=o.trimFloat(i),Math.abs(i)>=1?e=!0:this.lastState.velocity.x==this.hero.speed.x&&this.lastState.velocity.y==this.hero.speed.y&&this.lastState.state==this.hero.curState&&this.lastState.direction==this.hero.direction||(e=!0)}else e=!0;else if(2===this.synSelectedIndex){var s=cc.v2(0,0);if(this.lastState){var n=(cc.vv.serverTime.getTime()-this.lastStateTime)/1e3,r=this.lastState.velocity.mul(n);s.addSelf(this.lastState.position),s.addSelf(r)}s.subSelf(this.hero.node.getPosition()).mag()>5&&(e=!0)}e&&this.sendSynActorPos()}this.send_update_pos_time-=t}},sendSynActorPos:function(){if(this.isStart()&&this.hero){var t={};t.x=o.trimFloat(this.hero.node.getPosition().x),t.y=o.trimFloat(this.hero.node.getPosition().y),t.direction=this.hero.direction,t.state=this.hero.curState,t.vx=o.trimFloat(this.hero.speed.x),t.vy=o.trimFloat(this.hero.speed.y),t.sTime=cc.vv.serverTime.getTime(),cc.vv.gameNetMgr.sendSynActorPos(t),this.lastState={},this.lastState.velocity=cc.v2(t.vx,t.vy),this.lastState.position=cc.v2(t.x,t.y),this.lastState.direction=t.direction,this.lastState.state=t.state,this.lastState.time=t.sTime,this.lastStateTime=cc.vv.serverTime.getTime()}},sendSynActorState:function(){if(this.isStart()){var t={};t.x=o.trimFloat(this.hero.node.getPosition().x),t.y=o.trimFloat(this.hero.node.getPosition().y),t.direction=this.hero.sendDirection,t.state=this.hero.sendState,t.vx=o.trimFloat(this.hero.speed.x),t.vy=o.trimFloat(this.hero.speed.y),t.sTime=cc.vv.serverTime.getTime(),cc.vv.gameNetMgr.sendSynActorPos(t),this.lastState={},this.lastState.velocity=cc.v2(t.vx,t.vy),this.lastState.position=cc.v2(t.x,t.y),this.lastState.direction=t.direction,this.lastState.state=t.state,this.lastState.time=t.sTime,this.lastStateTime=cc.vv.serverTime.getTime()}},reciveSynActorPos:function(t){if(!this.hero||this.hero.roleId!==t.roleId)for(var e=0;e<this.players.length;e++){var i=this.players[e];i.roleId===t.roleId&&i.reciveSynPos(t)}},reciveBrickColliderEnter:function(t){if(this.hero&&0===this.hero.teamId)for(var e=0;e<this.players.length;e++){(a=this.players[e]).roleId===t.roleId?(a.score=t.score,this.gameUI.setScore(a.roleId,a.score),a.roleId===this.roleId?this.map.setBrickColor(t.gridId,s.Color.Blue):a.ownsBirckColor===s.Color.Blue?this.map.setBrickColor(t.gridId,this.hero.ownsBirckColor):this.map.setBrickColor(t.gridId,a.ownsBirckColor)):a.roleId===t.otherRoleId&&(a.score=t.otherScore,this.gameUI.setScore(a.roleId,a.score))}else{for(var i=0;i<this.players.length;i++){(a=this.players[i]).roleId===t.roleId?(a.score=t.score,a.roleId===this.roleId?this.map.setBrickColor(t.gridId,a.teamColor,!1):this.map.setBrickColor(t.gridId,a.teamColor,!0)):a.roleId===t.otherRoleId&&(a.score=t.otherScore)}for(var o=this.getTeamScore(t.teamId),n=this.getTeamScore(t.otherTeamId),r=0;r<this.players.length;r++){var a=this.players[r];t.teamId===a.teamId?this.gameUI.setScore(a.roleId,o):0!=t.otherTeamId&&t.otherTeamId===a.teamId&&this.gameUI.setScore(a.roleId,n)}}},getTeamScore:function(t){if(0==t)return-1;for(var e=0,i=0;i<this.players.length;i++){var o=this.players[i];o.teamId===t&&(e+=o.score)}return e},gameBeginStartBacktime:function(){this.gameBeginBacktime_end=!1,this.gameUI.showBeginAnim(!0);var t=this;setTimeout(function(){t.gameEndStartBacktime()},3e3)},gameEndStartBacktime:function(){this.gameBeginBacktime_end=!0,this.gameUI.showBeginAnim(!1)},gameOverStartCount:function(){this.setDebugDraw(!1),this.gameUI.showGameOverAnim(!0);var t=this;setTimeout(function(){t.gameOverEndCount()},6e3)},gameOverEndCount:function(){var t=this;console.log("gameOverEndCount"),console.log("this.winCamera:"+this.winCamera+" this.winCamera.name:"+this.winCamera.name+" this:"+this.name),this.winRole&&this.winRole.roleId===this.hero.roleId&&cc.vv.audioMgr.playSFX(cc.vv.resManager.gameOverWin),this.winCamera.node.active=!0,this.winCamera.addZoomInCallBack(function(){t.winRole?t.winRole.roleId===t.hero.roleId?t.gameUI.endGame(s.WinType.Win):t.gameUI.endGame(s.WinType.Lose):t.gameUI.endGame(s.WinType.Tie)}),console.log("gameOverEndCount1"),this.winCamera.setCameraTarget(this.hero.node),this.gameUI.showGameOverAnim(!1)},QueryTimeStamp:function(){return cc.vv.yySdk.getUrlParam("timestamp")},QueryNonstr:function(){return cc.vv.yySdk.getUrlParam("nonstr")},QuerySign:function(){return cc.vv.yySdk.getUrlParam("sign")},QueryPost_data:function(){return cc.vv.yySdk.getUrlParam("post_data")},getUrlParam:function(t){return cc.vv.yySdk.getUrlParam(t)},analyseUrlParams:function(){cc.vv.yySdk.analyseUrlParams()},createWSUrl:function(){return cc.vv.yySdk.createWSUrl()},printMsg:function(t){cc.vv.yySdk.printMsg(t)},updateLoadingBarProgress:function(t){cc.vv.yySdk.updateLoadingBarProgress(t)},gameLoadingFinish:function(){cc.vv.yySdk.gameLoadingFinish()},appEnterBackground:function(){cc.vv.gameNetMgr.sendAppEnterBackground()},onPKGameReady:function(){this.printMsg("game-ready"),cc.vv.audioMgr.playBGM(cc.vv.resManager.bgAudio)},gamePKStart:function(){cc.vv.yySdk.gamePKStart()},onPKExceptionFinish:function(){cc.vv.yySdk.onPKExceptionFinish()},isStart:function(){return this.gameStart},gameInit:function(t){var e=t.userLength,i=t.users;0===s.lastTime&&(s.lastTime=cc.vv.serverTime.getTime());for(var o=0;o<e;o++){var n=i[o];if(this.roleId===n.roleId){var r=cc.instantiate(this.heroPrefab);r.parent=this.node,r.active=!1,this.hero=r.getComponent("HeroControl"),this.hero.uid=n.uid,this.hero.roleId=n.roleId,this.hero.ownsBirckColor=n.color,this.hero.teamId=n.teamId,this.hero.resId=n.init_pos-1;var a=this.rolePos.find(n.init_pos);console.log("设置主角的初始位置："+a.x+" "+a.y),this.hero.setInitPos(a.x,a.y);var h=cc.vv.resManager.getSpineSkeletData(this.hero.resId);this.hero.setSpineSkeletData(h),this.players.push(this.hero)}else{var c=cc.instantiate(this.playerPrefab);c.parent=this.node,c.active=!1;var l=c.getComponent("Player");l.uid=n.uid,l.roleId=n.roleId,l.ownsBirckColor=n.color,l.teamId=n.teamId,l.resId=n.init_pos-1;var d=this.rolePos.find(n.init_pos);l.setInitPos(d.x,d.y);var u=cc.vv.resManager.getSpineSkeletData(l.resId);l.setSpineSkeletData(u),console.log("设置其他角色的初始位置："+d.x+" "+d.y),this.players.push(l)}}0!=this.hero.teamId&&this.initTeamInfo(),this.gameUI.initGameUI()},initTeamInfo:function(){for(var t=0;t<this.players.length;t++){var e=this.players[t];if(cc.vv.globalConfig.isDebugMode){var i=e.node.getChildByName("id");i.active=!0,i.getComponent(cc.Label).string=e.roleId}e.teamId===this.hero.teamId?e.teamColor=s.Color.Blue:e.teamColor=s.Color.Green}},startGame:function(t){for(var e=0;e<this.players.length;e++){var i=this.players[e];i.node.active=!0,i.initPos()}this.gameStart=!0,this.gameBeginStartBacktime(),this.gameLoadingFinish(),this.gamePKStart()},onPaintSettlement:function(t){console.log("游戏结束");var e=this.getWinRoleId();0!=this.hero.teamId&&e===this.hero.teamId?(this.winRole=this.hero,this.hero.setState(a.ST_WIN)):this.hero.roleId===e?(this.winRole=this.hero,this.hero.setState(a.ST_WIN)):this.hero.setState(a.ST_LOSE),this.gameStart=!1},onSSystemRResult:function(t){cc.vv.yySdk.onSSystemRResult(t)},setRoleId:function(t){this.roleId=t},getRoleId:function(){return this.roleId},getWinRoleId:function(){if(0===this.hero.teamId){for(var t=0,e=0,i=0,o=0;o<this.players.length;o++){var s=this.players[o];t<s.score?(t=s.score,i=0,e=s.roleId):t===s.score&&i++}return i>0?-1:e}for(var n=0,r=0,a=0,h=0;h<this.players.length;h++){var c=this.players[h];c.teamId===this.hero.teamId?n+=c.score:(a=c.teamId,r+=c.score)}return n===r?-1:n>=r?this.hero.teamId:a}}),cc._RF.pop()},{ActorConst:"ActorConst",Dictionary:"Dictionary",GameUI:"GameUI",GlobalUtil:"GlobalUtil",HeroControl:"HeroControl",MathUtil:"MathUtil",Player:"Player"}],GlobalConfig:[function(t,e,i){"use strict";cc._RF.push(e,"0f556UnQCBOOKqQFAxXuhwN","GlobalConfig"),cc.Class({extends:cc.Component,properties:{isDebugMode:!1}}),cc._RF.pop()},{}],GlobalUtil:[function(t,e,i){"use strict";cc._RF.push(e,"c0d82Ibrz5LR49ojv6bA7zp","GlobalUtil");var o=cc.Enum({None:0,Color:1,ColorNoAnim:2,NoColor:3,LT:4,RT:5}),s=cc.Enum({ColorBrick:1,Wall:2,Player:3,Hero:4}),n=cc.Enum({None:0,Pink:1,Blue:2,Green:3,Yellow:4}),r=cc.Enum({None:0,PaintStart:1,PaintEnd:2});e.exports={removeByValue:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t.splice(i,1),!0;return!1},Color:n,TimerType:r,GridType:o,CollideType:s,GameId:1,elapse:0,lastTime:0,WinType:{Lose:-1,Tie:0,Win:1}},cc._RF.pop()},{}],HeroControl:[function(t,e,i){"use strict";cc._RF.push(e,"339d2dg1QpEKKxBJBzHiDJ0","HeroControl");var o=t("GlobalUtil"),s=t("ActorConst"),n=t("Actor"),r=s.ActState,a=s.ColDir;cc.Class({extends:n,properties:{gravity:-1e3,drag:1e3,jumpSpeed:300,score:0,ownsBirckColor:o.Color.None,uid:""},onLoad:function(){this._super(),cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:this.onKeyPressed.bind(this),onKeyReleased:this.onKeyReleased.bind(this)},this.node),this.spineAnim=this.node.getChildByName("body").getComponent("SpineAnim"),this.particleSys=this.node.getChildByName("Particle").getComponent(cc.ParticleSystem),this.isParticleStop=!0,this.headHintAnim=cc.find("hint/Prompt1",this.node).getComponent(cc.Animation),this.bodyHintAnim=cc.find("hint/Prompt",this.node).getComponent(cc.Animation),this.yColliderList=[],this.xColliderList=[],this.collisionX=a.NONE,this.collisionY=a.NONE,this.otherColX=a.NONE,this.colPlayerY=a.NONE,this.colPlayerX=a.NONE,this.xColPlayer=[],this.xColPlayerList=[],this.yColPlayerList=[],this.prePosition=cc.v2(),this.preStep=cc.v2(),this.leftColPlayer=null,this.rightColPlayer=null,console.log(" onLoad this.node.pos :"+this.node.getPosition()+" this.maxStepSx: "+this.maxStepSx+" this.maxStepSy:"+this.maxStepSy)},start:function(){this._super(),this.node.zIndex=2,this.setState(r.ST_WAIT),this.beginHint(),console.log(" start this.node.pos :"+this.node.getPosition())},beginHint:function(){this.headHintAnim.play("Prompt_1"),this.bodyHintAnim.play("Prompt")},setOtherColXNone:function(){this.otherColX=a.NONE;for(var t=0;t<this.xColPlayer.length;t++){var e=this.xColPlayer[t];e.otherColX!=a.NONE&&e.setOtherColXNone()}},setSpineSkeletData:function(t){this._super(t)},isOtherColX:function(){this.isCheckOtherColX=!0;for(var t=0;t<this.xColPlayer.length;t++){var e=this.xColPlayer[t];if(!1===e.isCheckOtherColX){if(e.collisionX!=a.NONE)return!0;if(e.isOtherColX())return!0}}return!1},setCheckOtherColX:function(t){this.isCheckOtherColX=t;for(var e=0;e<this.xColPlayer.length;e++){var i=this.xColPlayer[e];i.isCheckOtherColX!=t&&i.setCheckOtherColX(t)}},onKeyPressed:function(t,e){this.handleKeyPressed(t)},onKeyReleased:function(t,e){this.handleKeyReleased(t)},handleKeyPressed:function(t){switch(t){case cc.KEY.a:case cc.KEY.left:this.direction=this.directionLeft,this.faceDirection=this.directionLeft,this.curState!==r.ST_WAIT&&this.curState!==r.ST_SQUAT&&this.curState!==r.ST_BE_PUSHED||this.setState(r.ST_RUN);break;case cc.KEY.d:case cc.KEY.right:this.direction=this.directionRight,this.faceDirection=this.directionRight,this.curState!==r.ST_WAIT&&this.curState!==r.ST_SQUAT&&this.curState!==r.ST_BE_PUSHED||this.setState(r.ST_RUN);break;case cc.KEY.space:this.curState!==r.ST_WAIT&&this.curState!==r.ST_RUN&&this.curState!==r.ST_WALK&&this.curState!==r.ST_LAND&&this.curState!==r.ST_BE_PUSHED||this.setState(r.ST_JUMP)}this.autoFaceTo()},handleKeyReleased:function(t){if(!t)return this.direction=this.directionIdle,void(this.curState!==r.ST_WALK&&this.curState!==r.ST_RUN&&this.curState!==r.ST_BE_PUSHED&&this.curState!==r.ST_RUN_BE_PUSHED||this.setState(r.ST_WAIT));switch(t){case cc.KEY.a:case cc.KEY.left:case cc.KEY.d:case cc.KEY.right:this.direction=this.directionIdle,this.curState!==r.ST_WALK&&this.curState!==r.ST_RUN&&this.curState!==r.ST_BE_PUSHED&&this.curState!==r.ST_RUN_BE_PUSHED||this.setState(r.ST_WAIT)}},setState:function(t){if(this.curState!==t&&this.curState!==r.ST_LOSE&&this.curState!==r.ST_WIN){switch(t===r.ST_WAIT||t===r.ST_LOSE||t===r.ST_WIN?(this.particleSys.stopSystem(),this.isParticleStop=!0):this.isParticleStop&&(this.particleSys.resetSystem(),this.isParticleStop=!1),console.log("hero newState:"+t),this._super(t),t){case r.ST_WAIT:this.jumping=!1,this.spineAnim.idle();break;case r.ST_JUMP:this.jumping=!0,this.speed.y=this.jumpSpeed,this.spineAnim.jump(),cc.vv.audioMgr.playSFX(cc.vv.resManager.jumpAudio);break;case r.ST_LAND:break;case r.ST_RUN:this.jumping=!1,this.spineAnim.run();break;case r.ST_SQUAT:break;case r.ST_BE_PUSHED:this.spineAnim.idle();break;case r.ST_FALL:break;case r.ST_WIN:this.spineAnim.win(),this.speed.x=0,this.speed.y=0;break;case r.ST_LOSE:this.speed.x=0,this.speed.y=0,this.spineAnim.lose()}this.game&&this.game.sendSynActorPos()}},onCollisionBrickEnter:function(t,e){},onCollisionPlayerEnter:function(t,e){var i=t.world.aabb,o=t.world.preAabb.clone(),s=e.world.aabb,n=e.world.preAabb.clone(),h=t.node.getComponent("Player");if(console.log("hero onCollisionPlayerEnter this.xCollider.name: "+t.name+" this.curState:"+this.curState+" this.isYDiff(player): "+this.isYDiff(h)+" player.curState:"+h.curState),n.x=s.x,o.x=i.x,this.curState===r.ST_WAIT||this.curState===r.ST_BE_PUSHED){if(h.isMoveOrBePushed()&&0==this.isYDiff(h)&&cc.Intersection.rectRect(n,o))return h.getSpeedX()>0&&n.xMax>o.xMax?(this.collisionX===a.COL_RIGHT||this.otherColX===a.COL_RIGHT?h.otherColX=a.COL_RIGHT:this.isBePushedLeft||(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x),this.leftColPlayer=h,this.colPlayerX=a.COL_LEFT,this.isBePushedRight=!0,this.setAddSpX(h.roleId,h.getSpeedX()),this.setState(r.ST_BE_PUSHED)):h.getSpeedX()>0&&n.xMax<o.xMax?h.collisionX!==a.COL_RIGHT&&h.otherColX!==a.COL_RIGHT||(this.node.x=2+i.xMin-s.width/2-this.node.parent.x):h.getSpeedX()<0&&n.xMin<o.xMin?(this.collisionX===a.COL_LEFT||this.otherColX===a.COL_LEFT?h.otherColX=a.COL_LEFT:this.isBePushedRight||(this.node.x=2+i.xMin-s.width/2-this.node.parent.x),this.rightColPlayer=h,this.colPlayerX=a.COL_RIGHT,this.setAddSpX(h.roleId,h.getSpeedX()),this.isBePushedLeft=!0,this.setState(r.ST_BE_PUSHED)):h.getSpeedX()<0&&n.xMin>o.xMin?h.collisionX!==a.COL_LEFT&&h.otherColX!==a.COL_LEFT||(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x):(h.curState===r.ST_WAIT&&n.xMax>o.xMax?(this.setAddSpX(h.roleId,0),this.isBePushedRight=!1):h.curState===r.ST_WAIT&&n.xMin<o.xMin&&(this.setAddSpX(h.roleId,0),this.isBePushedLeft=!1),!1===this.isBePushedLeft&&!1===this.isBePushedRight&&this.setState(r.ST_WAIT)),this.xColPlayerList.push(t),this.xColPlayer.push(h),console.log("hero onCollisionPlayerEnter this.xCollider.name: "+t.name+" this.colPlayerX: "+this.colPlayerX+" other.node.getPosition():"+t.node.getPosition()),void(this.game&&this.game.sendSynActorPos())}else if(this.isMove()||this.curState===r.ST_RUN_BE_PUSHED){if(h.isWait()&&0==this.isYDiff(h)){if(this.curState===r.ST_RUN_BE_PUSHED&&this.setState(r.ST_RUN),cc.Intersection.rectRect(n,o))return this.speed.x<0&&n.xMax>o.xMax?(this.colPlayerX=a.COL_LEFT,this.otherColX===a.COL_LEFT?this.node.x=-2+o.xMax+n.width/2-this.node.parent.x:h.curState===r.ST_BE_PUSHED&&h.isBePushedRight&&(this.node.x=-2+o.xMax+n.width/2-this.node.parent.x)):this.speed.x>0&&n.xMin<o.xMin&&(this.colPlayerX=a.COL_RIGHT,this.otherColX===a.COL_RIGHT?this.node.x=2+o.xMin-n.width/2-this.node.parent.x:h.curState===r.ST_BE_PUSHED&&h.isBePushedLeft&&(this.node.x=2+o.xMin-n.width/2-this.node.parent.x)),this.xColPlayerList.push(t),this.xColPlayer.push(h),void(this.game&&this.game.sendSynActorPos())}else if((h.isMove()||h.curState===r.ST_RUN_BE_PUSHED)&&0==this.isYDiff(h)){this.speed.x,h.speed.x;var c=!1;s.xMin<i.xMin?(this.node.x=2+i.xMin-s.width/2-this.node.parent.x,this.direction!=h.direction&&this.direction===this.directionRight&&(c=!0)):s.xMax>i.xMax&&(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x,this.direction!=h.direction&&this.direction===this.directionLeft&&(c=!0)),this.runBePushSpX=0,c?this.setState(r.ST_RUN_BE_PUSHED):(this.direction===this.directionLeft?this.speed.x=-Math.abs(this.speed.x):this.speed.x=Math.abs(this.speed.x),this.speed.x=this.setVxToMax(this.speed.x),this.setState(r.ST_RUN)),this.xColPlayerList.push(t),this.xColPlayer.push(h),this.game&&this.game.sendSynActorPos()}}else if(this.isJump()){if(n.y=s.y,o.y=i.y,cc.Intersection.rectRect(n,o)){if(this.speed.y<0&&n.yMax>o.yMax)this.node.y=o.yMax-this.node.parent.y,console.log("this.node.y 4: "+this.node.y),this.colPlayerY=a.COL_DOWN,this.setState(r.ST_LAND);else if(this.speed.y>0&&n.yMin<o.yMin){if(this.collisionY===a.COL_DOWN||this.colPlayerY===a.COL_DOWN)return;this.node.y=o.yMin-n.height-this.node.parent.y,console.log("this.node.y 3: "+this.node.y),this.colPlayerY=a.COL_UP}this.yColPlayerList.push(t),this.speed.y=0}this.game&&this.game.sendSynActorPos()}},onCollisionWallEnter:function(t,e){var i=t.world.aabb,o=t.world.preAabb.clone(),s=e.world.aabb,n=e.world.preAabb.clone();if(n.x=s.x,o.x=i.x,cc.Intersection.rectRect(n,o))return(this.speed.x<0||this.colPlayerX===a.COL_RIGHT)&&n.xMax>o.xMax?(this.node.x=-2+o.xMax+n.width/2-this.node.parent.x,this.collisionX=a.COL_LEFT):(this.speed.x>0||this.colPlayerX===a.COL_LEFT)&&n.xMin<o.xMin&&(this.node.x=2+o.xMin-n.width/2-this.node.parent.x,this.collisionX=a.COL_RIGHT),this.xColliderList.push(t),void(this.speed.x=0);cc.Intersection.rectRect(s,i)&&(this.speed.y<0&&s.yMax>i.yMax?(this.node.y=i.yMax-this.node.parent.y,this.collisionY=a.COL_DOWN,this.setState(r.ST_LAND)):this.speed.y>0&&s.yMin<i.yMin&&(this.node.y=i.yMin-s.height-this.node.parent.y,this.collisionY=a.COL_UP),this.yColliderList.push(t),this.speed.y=0)},onCollisionEnter:function(t,e){switch(this.aabb=e.world.aabb,e.ownsBirckColor||(e.ownsBirckColor=this.ownsBirckColor),t.tag){case o.CollideType.ColorBrick:this.onCollisionBrickEnter(t,e);break;case o.CollideType.Wall:this.onCollisionWallEnter(t,e);break;case o.CollideType.Player:this.onCollisionPlayerEnter(t,e);break;default:this.onCollisionWallEnter(t,e)}},onCollisionPlayerStay:function(t,e){var i=t.world.aabb,o=t.world.preAabb.clone(),s=e.world.aabb,n=e.world.preAabb.clone(),h=t.node.getComponent("Player");if(n.x=s.x,o.x=i.x,this.curState===r.ST_WAIT||this.curState===r.ST_BE_PUSHED){if(h.isMoveOrBePushed()&&0==this.isYDiff(h)&&cc.Intersection.rectRect(n,o))return void(h.getSpeedX()>0&&n.xMax>o.xMax?(this.collisionX===a.COL_RIGHT||this.otherColX===a.COL_RIGHT?h.otherColX=a.COL_RIGHT:this.isBePushedLeft||(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x),this.leftColPlayer=h,this.colPlayerX=a.COL_LEFT,this.isBePushedRight=!0,this.setAddSpX(h.roleId,h.getSpeedX()),this.setState(r.ST_BE_PUSHED)):h.getSpeedX()>0&&n.xMax<o.xMax?h.collisionX!==a.COL_RIGHT&&h.otherColX!==a.COL_RIGHT||(this.node.x=2+i.xMin-s.width/2-this.node.parent.x):h.getSpeedX()<0&&n.xMin<o.xMin?(this.collisionX===a.COL_LEFT||this.otherColX===a.COL_LEFT?h.otherColX=a.COL_LEFT:this.isBePushedRight||(this.node.x=2+i.xMin-s.width/2-this.node.parent.x),this.rightColPlayer=h,this.colPlayerX=a.COL_RIGHT,this.setAddSpX(h.roleId,h.getSpeedX()),this.isBePushedLeft=!0,this.setState(r.ST_BE_PUSHED)):h.getSpeedX()<0&&n.xMin>o.xMin?h.collisionX!==a.COL_LEFT&&h.otherColX!==a.COL_LEFT||(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x):(h.curState===r.ST_WAIT&&n.xMax>o.xMax?(this.setAddSpX(h.roleId,0),this.isBePushedRight=!1):h.curState===r.ST_WAIT&&n.xMin<o.xMin&&(this.setAddSpX(h.roleId,0),this.isBePushedLeft=!1),!1===this.isBePushedLeft&&!1===this.isBePushedRight&&this.setState(r.ST_WAIT)))}else if(this.isMove()||this.curState===r.ST_RUN_BE_PUSHED)if(h.isWait()&&0==this.isYDiff(h)){if(this.curState===r.ST_RUN_BE_PUSHED&&this.setState(r.ST_RUN),cc.Intersection.rectRect(n,o))return void(this.speed.x<0&&n.xMax>o.xMax?(this.colPlayerX=a.COL_LEFT,this.otherColX===a.COL_LEFT?this.node.x=-2+o.xMax+n.width/2-this.node.parent.x:h.curState===r.ST_BE_PUSHED&&h.isBePushedRight&&(this.node.x=-2+o.xMax+n.width/2-this.node.parent.x)):this.speed.x>0&&n.xMin<o.xMin&&(this.colPlayerX=a.COL_RIGHT,this.otherColX===a.COL_RIGHT?this.node.x=2+o.xMin-n.width/2-this.node.parent.x:h.curState===r.ST_BE_PUSHED&&h.isBePushedLeft&&(this.node.x=2+o.xMin-n.width/2-this.node.parent.x)))}else if((h.isMove()||h.curState===r.ST_RUN_BE_PUSHED)&&0==this.isYDiff(h)){this.speed.x,h.speed.x;var c=!1;h.curState!=r.ST_RUN_BE_PUSHED?s.xMin<i.xMin?(this.node.x=2+i.xMin-s.width/2-this.node.parent.x,this.direction!=h.direction&&this.direction===this.directionRight&&(c=!0)):s.xMax>i.xMax&&(this.node.x=-2+i.xMax+s.width/2-this.node.parent.x,this.direction!=h.direction&&this.direction===this.directionLeft&&(c=!0)):(this.node.x=this.node.x,s.xMin<i.xMin?this.direction!=h.direction&&this.direction===this.directionRight?c=!0:this.node.x=i.xMin-s.width/2-this.node.parent.x:s.xMax>i.xMax&&(this.direction!=h.direction&&this.direction===this.directionLeft?c=!0:this.node.x=i.xMax+s.width/2-this.node.parent.x)),c?this.setState(r.ST_RUN_BE_PUSHED):(this.direction===this.directionLeft?this.speed.x=-Math.abs(this.speed.x):this.speed.x=Math.abs(this.speed.x),this.speed.x=this.setVxToMax(this.speed.x),this.setState(r.ST_RUN),console.log("hero this.setState(ActState.ST_RUN):"+this.curState+" this.speed.x:"+this.speed.x)),this.runBePushSpX=0}},onCollisionWallStay:function(t,e){},onCollisionStay:function(t,e){switch(t.tag){case o.CollideType.Player:this.onCollisionPlayerStay(t,e);break;case o.CollideType.Wall:this.onCollisionWallStay(t,e)}if(this.collisionY===a.COL_DOWN){if("Platform"===t.node.group){var i=t.node.getComponent("PlatformMotion");i&&(this.node.x+=i._movedDiff)}this.speed.y<0&&(console.log("onCollisionStay this.speed.y:"+this.speed.y),this.speed.y=0)}},onCollisionOtherExit:function(t,e){if(o.removeByValue(this.xColliderList,t)&&this.xColliderList.length<=0){if(this.collisionX===a.COL_LEFT||this.collisionX===a.COL_RIGHT)for(var i=0;i<this.xColPlayer.length;i++){this.xColPlayer[i].setOtherColXNone()}console.log("hero onCollisionExit this.xColliderList.length: "+this.xColliderList.length+" Collider.name: "+t.name+" other.node.getPosition():"+t.node.getPosition()),this.collisionX=a.NONE}o.removeByValue(this.yColliderList,t)&&(console.log("hero onCollisionExit this.yColliderList.length: "+this.yColliderList.length+" Collider.name: "+t.name),this.yColliderList.length<=0&&(this.collisionY=a.NONE,this.setState(r.ST_FALL),this.jumping=!0))},onCollisionPlayerExit:function(t,e){t.world.aabb;var i=t.world.preAabb.clone(),s=(e.world.aabb,e.world.preAabb.clone());this.curState===r.ST_RUN_BE_PUSHED&&this.setState(r.ST_RUN),console.log("hero onCollisionPlayerExit Collider.name: "+t.name+" other.node.getPosition():"+t.node.getPosition());var n=t.node.getComponent("Player");this.leftColPlayer&&this.leftColPlayer.roleId===n.roleId&&this.isBePushedRight?(this.setAddSpX(n.roleId,0),this.isBePushedRight=!1,this.leftColPlayer=null):this.rightColPlayer&&this.rightColPlayer.roleId===n.roleId&&this.isBePushedLeft&&(this.setAddSpX(n.roleId,0),this.isBePushedLeft=!1,this.rightColPlayer=null),!1===this.isBePushedLeft&&!1===this.isBePushedRight&&this.curState===r.ST_BE_PUSHED&&(this.setState(r.ST_WAIT),console.log("hero onCollisionPlayerExit  ActState.ST_WAIT")),o.removeByValue(this.xColPlayerList,t)&&(o.removeByValue(this.xColPlayer,n),this.setAddSpX(n.roleId,0),console.log("hero onCollisionPlayerExit this.xColPlayerList.length: "+this.xColPlayerList.length+" Collider.name: "+t.name+" other.node.getPosition():"+t.node.getPosition()),this.xColPlayerList.length<=0&&(this.colPlayerX=a.NONE),console.log("hero onCollisionPlayerExit:  selfPreAabb.xMax "+s.xMax+" otherPreAabb.xMax: "+i.xMax+" this.isBePushedRight:"+this.isBePushedRight),console.log("hero onCollisionPlayerExit:  selfPreAabb.xMin "+s.xMin+" otherPreAabb.xMin: "+i.xMin+" this.isBePushedLeft:"+this.isBePushedLeft),this.isOtherColX()||(this.setOtherColXNone(),this.setCheckOtherColX(!1))),o.removeByValue(this.yColPlayerList,t)&&this.yColPlayerList.length<=0&&(this.colPlayerY=a.NONE)},onCollisionExit:function(t,e){switch(t.tag){case o.CollideType.ColorBrick:break;case o.CollideType.Player:this.onCollisionPlayerExit(t,e);break;default:this.onCollisionOtherExit(t,e)}},checkColidePlayer:function(){for(var t=!1,e=0;e<this.xColPlayer.length;e++){var i=this.xColPlayer[e];if((i.otherColX===a.COL_LEFT||i.collisionX===a.COL_LEFT)&&this.collisionX!=a.COL_LEFT)return this.otherColX=a.COL_LEFT,void(t=!0);if((i.otherColX===a.COL_RIGHT||i.collisionX===a.COL_RIGHT)&&this.collisionX!=a.COL_RIGHT)return this.otherColX=a.COL_RIGHT,void(t=!0)}!1===t&&(this.otherColX=a.NONE)},update:function(t){this.game.isStart()&&(this.updateState(),this.checkColidePlayer(),this.updateMove(t))},updateState:function(){switch(this.curState){case r.ST_WAIT:case r.ST_JUMP:break;case r.ST_LAND:this.direction===this.directionIdle?this.setState(r.ST_WAIT):this.setState(r.ST_RUN);break;case r.ST_RUN:case r.ST_SQUAT:case r.ST_FALL:}},correctVx:function(t){return Math.abs(t)>this.maxSpeed.x&&(t=t>0?this.maxSpeed.x:-this.maxSpeed.x),t},setVxToMax:function(t){return Math.abs(t)<this.maxSpeed.x&&(t=t>0?this.maxSpeed.x:-this.maxSpeed.x),t=this.correctVx(t)},correctVy:function(t){return Math.abs(t)>this.maxSpeed.y&&(t=t>0?this.maxSpeed.y:-this.maxSpeed.y),t},updateMove:function(t){if(this.curState!==r.ST_LOSE&&this.curState!==r.ST_WIN&&this.game.map.isMapCreated){this.collisionY===a.NONE&&(this.speed.y+=this.gravity*t,this.speed.y=this.correctVy(this.speed.y)),this.direction===this.directionIdle?this.speed.x=0:this.curState===r.ST_RUN_BE_PUSHED?this.speed.x=this.setVxToMax(this.speed.x):(this.speed.x+=(this.direction>0?this.directionRight:this.directionLeft)*this.drag*t,this.speed.x=this.correctVx(this.speed.x));var e=0;this.speed.x*this.collisionX>0?e=0:this.speed.x*this.otherColX>0?e=0:this.curState===r.ST_RUN_BE_PUSHED?(this.runBePushSpX>0&&this.direction===this.directionRight?e=this.runBePushSpX:this.runBePushSpX<0&&this.direction===this.directionLeft&&(e=this.runBePushSpX),e=this.correctVx(e),console.log(" vx:"+e+" this.runBePushSpX:"+this.runBePushSpX)):e=this.speed.x,(this.speed.y*this.collisionY>0||this.speed.y*this.colPlayerY>0)&&(this.speed.y=0),this.prePosition.x=this.node.x,this.prePosition.y=this.node.y;var i=this.correctStepSx(e*t),o=this.correctStepSy(this.speed.y*t);this.preStep.x=i,this.preStep.y=o,this.node.x+=i,this.node.y+=o,this.correctPos()}}}),cc._RF.pop()},{Actor:"Actor",ActorConst:"ActorConst",GlobalUtil:"GlobalUtil"}],JoystickCommon:[function(t,e,i){"use strict";cc._RF.push(e,"2f218v14+5ApY52tiPQqn49","JoystickCommon"),e.exports={TouchType:cc.Enum({DEFAULT:0,FOLLOW:1}),DirectionType:cc.Enum({TWO:2,FOUR:4,EIGHT:8,ALL:0})},cc._RF.pop()},{}],JoystickNode:[function(t,e,i){"use strict";cc._RF.push(e,"e98e7hxETxODLM8wGu55+mC","JoystickNode");var o=t("JoystickCommon"),s=t("Joystick");cc.Class({extends:cc.Component,properties:{movePiont:{default:null,type:cc.Node,displayName:"摇杆节点"},fixedPoint:{default:null,type:s,displayName:"摇杆背景节点"},stickX:{default:0,displayName:"摇杆X位置"},stickY:{default:0,displayName:"摇杆Y位置"},touchType:{default:o.TouchType.DEFAULT,type:o.TouchType,displayName:"触摸类型"},directionType:{default:o.DirectionType.ALL,type:o.DirectionType,displayName:"方向类型"},sprite:{default:null,type:cc.Node,displayName:"操控的目标"},_stickPos:{default:null,displayName:"摇杆当前位置"},_touchStartPos:{default:null,displayName:"摇杆开始移动位置"},_touchMovePos:{default:null,displayName:"当前触摸屏幕位置"},followSpeed:1e3,_maxMovePos:{default:null,displayName:"最大可移动到的位置"}},onLoad:function(){this._createStickSprite(),this.touchType==o.TouchType.FOLLOW&&this._initTouchEvent(),this.isMoving=!1},start:function(){this._maxMovePos=cc.p(317,296)},_createStickSprite:function(){this.fixedPoint.node.setPosition(this.stickX,this.stickY),this.movePiont.setPosition(this.stickX,this.stickY)},addJoyStickTouchMoveListener:function(t){this.touchMove=t},addJoyStickTouchEndListener:function(t){this.touchMoveEnd=t},_initTouchEvent:function(){var t=this;t.node.on(cc.Node.EventType.TOUCH_START,t._touchStartEvent,t),t.node.on(cc.Node.EventType.TOUCH_MOVE,t._touchMoveEvent,t),t.node.on(cc.Node.EventType.TOUCH_END,t._touchEndEvent,t),t.node.on(cc.Node.EventType.TOUCH_CANCEL,t._touchEndEvent,t)},_touchStartEvent:function(t){this.node.opacity=128,this._touchStartPos=t.getLocation();var e=this.node.convertToNodeSpaceAR(t.getLocation());this.fixedPoint.node.setPosition(e),this.movePiont.setPosition(e),this._stickPos=e,this.isMoving=!1},_touchMoveEvent:function(t){if(this._touchStartPos.x==t.getLocation().x&&this._touchStartPos.y==t.getLocation().y)return!1;var e=this.fixedPoint.node.convertToNodeSpaceAR(t.getLocation()),i=this.fixedPoint._getDistance(e,cc.p(0,0)),o=this.fixedPoint.node.width/2,s=this._stickPos,n=s.x+e.x,r=s.y+e.y;if(o>i)this.movePiont.setPosition(cc.p(n,r));else{var a=this._stickPos.x+Math.cos(this.fixedPoint._getRadian(cc.p(n,r)))*o,h=this._stickPos.y+Math.sin(this.fixedPoint._getRadian(cc.p(n,r)))*o;this.movePiont.setPosition(cc.p(a,h))}this.fixedPoint._getAngle(cc.p(n,r)),this.fixedPoint.updateMove()},_touchEndEvent:function(){this.node.opacity=255,this.fixedPoint.node.setPosition(this.stickX,this.stickY),this.movePiont.setPosition(this.fixedPoint.node.getPosition()),this.fixedPoint._speed=0,this.isMoving=!1,this.fixedPoint._angle=null,this.fixedPoint.curKey=-1,this.touchMoveEnd&&this.touchMoveEnd(null)},update:function(t){if(this.isMoving){var e=this.movePiont.position,i=cc.p(this._touchMovePos.x,this._touchMovePos.y);if(this.fixedPoint._getDistance(e,i)<=10)return this.movePiont.setPosition(i),void(this.isMoving=!1);var o=cc.pNormalize(cc.pSub(i,e)),s=cc.pMult(o,this.followSpeed*t);console.log("update moveDis.x : "+s.x+" moveDis.y: "+s.y);var n=cc.pAdd(e,s);this.movePiont.setPosition(n);var r=this.fixedPoint.node.position,a=cc.pAdd(r,s);this.fixedPoint.node.setPosition(a)}}}),cc._RF.pop()},{Joystick:"Joystick",JoystickCommon:"JoystickCommon"}],Joystick:[function(t,e,i){"use strict";cc._RF.push(e,"db0f2FiBgtK4rT6reD2+4vr","Joystick");var o=t("JoystickCommon");cc.Class({extends:cc.Component,properties:{dot:{default:null,type:cc.Node,displayName:"摇杆节点"},_joyCom:{default:null,displayName:"joy Node"},_playerNode:{default:null,displayName:"被操作的目标Node"},_angle:{default:null,displayName:"当前触摸的角度"},_radian:{default:null,displayName:"弧度"},_speed:0,_speed1:1,_speed2:2,_opacity:0},onLoad:function(){this.curKey=-1,this._joyCom=this.node.parent.getComponent("JoystickNode"),this._playerNode=this._joyCom.sprite,this._joyCom.touchType==o.TouchType.DEFAULT&&this._initTouchEvent()},_initTouchEvent:function(){var t=this;t.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,t),t.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,t),t.node.on(cc.Node.EventType.TOUCH_END,this._touchEndEvent,t),t.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEndEvent,t)},updateMove:function(){switch(this._joyCom.directionType){case o.DirectionType.TWO:this._twoDirectionsMove();break;case o.DirectionType.FOUR:this._fourDirectionsMove();break;case o.DirectionType.EIGHT:this._eightDirectionsMove();break;case o.DirectionType.ALL:this._allDirectionsMove()}},_twoDirectionsMove:function(){this._angle&&(this._angle<90&&this._angle>-90?this._joyCom.touchMove&&this.curKey!=cc.KEY.right&&(this.curKey=cc.KEY.right,this._joyCom.touchMove(cc.KEY.right)):(this._joyCom.touchMove&&this.curKey!=cc.KEY.left&&(this.curKey=cc.KEY.left),this._joyCom.touchMove(cc.KEY.left)))},_fourDirectionsMove:function(){this._angle>45&&this._angle<135?this._playerNode.y+=this._speed:this._angle>-135&&this._angle<-45?this._playerNode.y-=this._speed:this._angle<-135&&this._angle>-180||this._angle>135&&this._angle<180?this._playerNode.x-=this._speed:(this._angle<0&&this._angle>-45||this._angle>0&&this._angle<45)&&(this._playerNode.x+=this._speed)},_eightDirectionsMove:function(){this._angle>67.5&&this._angle<112.5?this._playerNode.y+=this._speed:this._angle>-112.5&&this._angle<-67.5?this._playerNode.y-=this._speed:this._angle<-157.5&&this._angle>-180||this._angle>157.5&&this._angle<180?this._playerNode.x-=this._speed:this._angle<0&&this._angle>-22.5||this._angle>0&&this._angle<22.5?this._playerNode.x+=this._speed:this._angle>112.5&&this._angle<157.5?(this._playerNode.x-=this._speed/1.414,this._playerNode.y+=this._speed/1.414):this._angle>22.5&&this._angle<67.5?(this._playerNode.x+=this._speed/1.414,this._playerNode.y+=this._speed/1.414):this._angle>-157.5&&this._angle<-112.5?(this._playerNode.x-=this._speed/1.414,this._playerNode.y-=this._speed/1.414):this._angle>-67.5&&this._angle<-22.5&&(this._playerNode.x+=this._speed/1.414,this._playerNode.y-=this._speed/1.414)},_allDirectionsMove:function(){this._playerNode.x+=Math.cos(this._angle*(Math.PI/180))*this._speed,this._playerNode.y+=Math.sin(this._angle*(Math.PI/180))*this._speed},_getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},_getRadian:function(t){return this._radian=Math.PI/180*this._getAngle(t),this._radian},_getAngle:function(t){var e=this.node.getPosition();return this._angle=Math.atan2(t.y-e.y,t.x-e.x)*(180/Math.PI),this._angle},_setSpeed:function(t){this._getDistance(t,this.node.getPosition())<this._radius?this._speed=this._speed1:this._speed=this._speed2},_touchStartEvent:function(t){this.node.opacity=128;var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=this._getDistance(e,cc.p(0,0)),o=this.node.width/2;this._stickPos=e;var s=this.node.getPosition().x+e.x,n=this.node.getPosition().y+e.y;return o>i&&(this.dot.setPosition(cc.p(s,n)),!0)},_touchMoveEvent:function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation()),i=this._getDistance(e,cc.p(0,0)),o=this.node.width/2,s=this.node.getPosition().x+e.x,n=this.node.getPosition().y+e.y;if(o>i)this.dot.setPosition(cc.p(s,n));else{var r=this.node.getPosition().x+Math.cos(this._getRadian(cc.p(s,n)))*o,a=this.node.getPosition().y+Math.sin(this._getRadian(cc.p(s,n)))*o;this.dot.setPosition(cc.p(r,a))}this._getAngle(cc.p(s,n)),this.updateMove()},_touchEndEvent:function(){this.node.opacity=255,this.dot.setPosition(this.node.getPosition()),this._speed=0,this._angle=null,this.curKey=-1,this._joyCom.touchMoveEnd&&this._joyCom.touchMoveEnd(null)}}),cc._RF.pop()},{JoystickCommon:"JoystickCommon"}],Map:[function(t,e,i){"use strict";cc._RF.push(e,"f85c872AGRA478QeKTpNZy8","Map");t("MathUtil");var o=t("csvjson"),s=t("Dictionary"),n=t("GlobalUtil").GridType;cc.Class({extends:cc.Component,properties:{brickPrefab:{default:null,type:cc.Prefab,displayName:"普通动画砖块"},brickLTPrefab:{default:null,type:cc.Prefab,displayName:"左下角砖块"},brickRTPrefab:{default:null,type:cc.Prefab,displayName:"右下角砖块"},brickNoAnimPrefab:{default:null,type:cc.Prefab,displayName:"普通没动画砖块"},brickNoCPrefab:{default:null,type:cc.Prefab,displayName:"普通不会变色砖块"},padding:0,spacing:0,swinSizeW:1134,MaxMapRows:13,MaxMapColunm:24,TileHeigt:39,TileWidth:39,colliderPrefab:cc.Prefab,mapDataArr:[],mapMaxX:0,mapMaxY:0,mapMinX:0,mapMinY:0},onLoad:function(){console.log("cc.winSize.width:"+cc.winSize.width),console.log("cc.winSize.height:"+cc.winSize.height);if(cc.winSize.width<960){var t=cc.find("Canvas").getComponent(cc.Canvas);t.fitHeight=!0,t.fitWidth=!0}this.brickDic=new s,this.node.setScale(1),this.node.x=(cc.winSize.width-1152)/2,this.node.y=(cc.winSize.height-624)/2,this.csvPath="AssetLoad",cc.loader.loadRes(this.csvPath,this.createMap.bind(this)),this.isMapCreated=!1,this.mapNode=this.node.getChildByName("mapLayer")},start:function(){},addLoadFinishedListener:function(t){this.loadFinishedCallBack=t,console.log("addLoadFinishedListener: callBack"+this.loadFinishedCallBack)},setBrickColor:function(t,e,i){this.brickDic.find(t).setColor(e,i)},createMap:function(t,e){if(t)console.log("Error url ["+t+"]");else{this._curRes=e,this.mapDataArr=o.csv2array(e,{delim:",",textdelim:'"'});for(var i=this.MaxMapRows,s=this.MaxMapColunm,r=0,a=i-1;a>=0;a--){for(var h=0,c=-1,l=0,d=0,u=0;u<s;u++){var p=this.mapDataArr[a][u];if(0!=p){var m=null;switch(p){case n.Color:m=cc.instantiate(this.brickPrefab);break;case n.ColorNoAnim:m=cc.instantiate(this.brickNoAnimPrefab);break;case n.NoColor:m=cc.instantiate(this.brickNoCPrefab);break;case n.LT:m=cc.instantiate(this.brickLTPrefab);break;case n.RT:m=cc.instantiate(this.brickRTPrefab);break;default:m=cc.instantiate(this.brickNoAnimPrefab)}m.parent=this.mapNode;var f=i-1-a;m.name=f+"_"+u+"_birck",m.x=this.padding+u*(this.TileWidth+this.spacing)+this.TileWidth/2,m.y=this.padding+(i-1-a)*(this.TileHeigt+this.spacing)+this.TileHeigt/2,r=f*this.MaxMapColunm+u;var y=m.getComponent("BrickColor");null!=y&&(y.initBrickType(p),y.gridId=r,this.brickDic.add(r,y)),a===i-1&&0===u&&(this.mapMinX=m.x+this.TileWidth/2-5,this.mapMinY=m.y+this.TileHeigt/2-5),0===a&&u===s-1?(this.mapMaxX=m.x-this.TileWidth/2+5,this.mapMaxY=m.y-this.TileHeigt/2+5):-1!==c&&c!==u-1||(-1===c&&(l=m.x,d=m.y),c=u,h++)}else{if(h>1){var g=cc.instantiate(this.colliderPrefab);g.parent=this.mapNode,g.group="Wall",g.x=l-this.TileWidth/2+h*(this.TileWidth+this.spacing)/2,g.y=d,g.getComponent("cc.BoxCollider").size=cc.size(h*(this.TileWidth+this.spacing),this.TileHeigt-1)}h=0,c=-1,l=0,d=0}}if(h>1){var S=cc.instantiate(this.colliderPrefab);S.parent=this.mapNode,S.group="Wall",S.x=l-this.TileWidth/2+h*(this.TileWidth+this.spacing)/2,S.y=d,S.getComponent("cc.BoxCollider").size=cc.size(h*(this.TileWidth+this.spacing),this.TileHeigt-1)}}this.checkCreateCollider()}},checkCreateCollider:function(){for(var t=this.MaxMapColunm,e=this.MaxMapRows,i=0;i<t;i++){for(var o=0,s=-1,n=0,r=0,a=0;a<e;a++)if(0!=this.mapDataArr[a][i])-1!==s&&s!==a-1||(o++,n=this.padding+i*(this.TileWidth+this.spacing)+this.TileWidth/2,r=this.padding+(e-1-a)*(this.TileHeigt+this.spacing)+this.TileHeigt/2);else{if(o>=3){var h=cc.instantiate(this.colliderPrefab);h.parent=this.mapNode,h.group="Wall",h.x=n,h.y=r-this.TileHeigt/2+o*(this.TileHeigt+this.spacing)/2,h.getComponent("cc.BoxCollider").size=cc.size(this.TileWidth-1,o*(this.TileHeigt+this.spacing))}o=0,s=-1,n=0,r=0}if(o>=3){var c=cc.instantiate(this.colliderPrefab);c.parent=this.mapNode,c.group="Wall",c.x=n,c.y=r-this.TileHeigt/2+o*(this.TileHeigt+this.spacing)/2,c.getComponent("cc.BoxCollider").size=cc.size(this.TileWidth-1,o*(this.TileHeigt+this.spacing))}}this.isMapCreated=!0,this.loadFinishedCallBack&&(console.log("this.loadFinishedCallBack"),this.loadFinishedCallBack())}}),cc._RF.pop()},{Dictionary:"Dictionary",GlobalUtil:"GlobalUtil",MathUtil:"MathUtil",csvjson:"csvjson"}],MathUtil:[function(t,e,i){"use strict";cc._RF.push(e,"be9fbg0ztRL8aBjNh86amTH","MathUtil"),cc.Class({extends:cc.Component,statics:{trimFloat:function(t){return parseInt(100*t)/100}}}),cc._RF.pop()},{}],NetConfig:[function(t,e,i){"use strict";cc._RF.push(e,"b5e79WseehEyLD1qOfOeWU6","NetConfig");var o=t("SHA-1"),s=cc.Enum({XIAO_WEI:1,TCTest:2,Offical:3});cc.Class({extends:cc.Component,properties:{netType:{default:s.XIAO_WEI,type:s,displayName:"连接服务器"}},onLoad:function(){this.netIPs={},this.netIPs[s.XIAO_WEI]={ip:"192.168.19.41",port:"42001"},this.netIPs[s.TCTest]={ip:"120.79.192.89",port:"42001"},this.netIPs[s.Offical]=null},getCurNetData:function(){return this.netIPs[this.netType]},getUrlParams:function(){console.log("enter roomid: 111");var t=Date.now().toString(),e={channelid:"kebao",gameid:"fenshuadashi",roomid:"111",player:{uid:t,name:t,opt:'{"ai":1,"level":2,"ai_info":{"uid":"900003312","nick":"Ming Xi","avatar":"http://s1.yy.com/guild/header/10001.jpg","sex":0}}',teamid:"",sex:1}},i=this.netIPs[this.netType].ip,s=this.netIPs[this.netType].port,n="1509095172",r="tQLw2Uq",a=JSON.stringify(e);console.log("last: "+a);var h=o.hex_sha1(n+r+a+"5pB4Prd8ReRLFVBp6pnKoFOhRlsKBtL6");return console.log("sign:"+h),a=encodeURIComponent(a),console.log("last: "+a),"?wsscheme=ws&websocketdomain="+i+"&port="+s+"&wsscheme=ws&timestamp="+n+"&nonstr="+r+"&sign="+h+"&post_data="+a}}),cc._RF.pop()},{"SHA-1":"SHA-1"}],NetState:[function(t,e,i){"use strict";var o;function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}cc._RF.push(e,"f97b3oFZ7NEYritsA7nhE4v","NetState");var n=t("ActorConst").ActState;cc.Class({extends:cc.Component,properties:(o={timestamp:0,pos:cc.v2(260,86),state:0,direction:0},s(o,"state",n.ST_WAIT),s(o,"vx",0),s(o,"vy",0),o)}),cc._RF.pop()},{ActorConst:"ActorConst"}],Net:[function(t,e,i){"use strict";cc._RF.push(e,"6ff25KCdXJJnIX64PC+MUif","Net");t("DataStream"),t("GlobalUtil"),cc.Class({extends:cc.Component,statics:{ip:"",ws:null,isPinging:!1,fnDisconnect:null,connect:function(t,e){var i=this;null==i.ws?(console.log("this.ip: "+this.ip),i.ws=new WebSocket(this.ip),i.ws.binaryType="arraybuffer",i.ws.onopen=function(e){console.log("connect to server success."),i.ws.connected=!0,t&&t()},i.ws.onmessage=function(t){cc.vv.gameNetMgr.doHandleMessage(t.data)},i.ws.onerror=function(t){console.log("send msg fired an error:"+t.message),e&&e(),i.close()},i.ws.onclose=function(t){console.log("WebSocket instance closed"),e&&e(),i.close()},setTimeout(function(){switch(i.ws.readyState){case WebSocket.CONNECTING:console.log("WebSocket is CONNECTING");break;case WebSocket.OPEN:console.log("WebSocket is OPEN");break;case WebSocket.CLOSING:console.log("WebSocket is CLOSING");break;case WebSocket.CLOSED:console.log("WebSocket is CLOSED");break;default:console.log("WebSocket readyState: "+ws.readyState)}},3)):console.warn("请勿重新创建WebSocket连接！")},send:function(t){this.ws&&this.ws.connected&&this.ws.send(t.buffer)},close:function(){console.log("close"),this.delayMS=null,this.ws&&this.ws.connected&&(this.ws.connected=!1,this.ws.close()),this.ws=null,this.fnDisconnect&&(this.fnDisconnect(),this.fnDisconnect=null)}}});cc._RF.pop()},{DataStream:"DataStream",GlobalUtil:"GlobalUtil"}],PlatformMotion:[function(t,e,i){"use strict";cc._RF.push(e,"0f761EZmKhNLKJpUXTrb4fF","PlatformMotion"),cc.Class({extends:cc.Component,properties:{speed:10,distance:200},onLoad:function(){this._movedDistance=this.distance/2,this._direction=1,this._movedDiff=0},update:function(t){var e=this.speed*this._direction*t,i=this._movedDistance+Math.abs(e);this._movedDistance+=Math.abs(e),i>this.distance?(e=this.distance-this._movedDistance,this._movedDistance=0,this._direction*=-1):this._movedDistance=i,this.node.x+=e,this._movedDiff=e}}),cc._RF.pop()},{}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"be13bqoFFNEgYc9NJilnMba","Player");var o=t("GlobalUtil"),s=t("ActorConst"),n=t("Actor"),r=t("NetState"),a=s.ActState,h=s.ColDir;cc.Class({extends:n,properties:{gravity:-1e3,drag:1e3,jumpSpeed:1800,score:0,ownsBirckColor:o.Color.None,uid:"",position:cc.v2(0,0),modify:cc.v2(0,0),smoothFactor:.075,isCrrectPos:!1},onLoad:function(){this._super(),this.spineAnim=this.node.getChildByName("body").getComponent("SpineAnim"),this.yColliderList=[],this.xColliderList=[],this.collisionX=h.NONE,this.collisionY=h.NONE,this.otherColX=h.NONE,this.colPlayerY=h.NONE,this.colPlayerX=h.NONE,this.xColPlayer=[],this.xColPlayerList=[],this.yColPlayerList=[],this.position.x=this.node.x,this.position.y=this.node.y,this.interpolationBackTime=100,this.m_BufferedState=new Array(20),this.m_TimestampCount=0;for(var t=this.m_BufferedState.length-1;t>=0;t--){var e=new r;this.m_BufferedState[t]=e}this.mLastUpdateTime=0,this.bufferQueue=new Array,this.leftColPlayer=null,this.rightColPlayer=null},start:function(){this._super(),this.setState(a.ST_WAIT)},setSpineSkeletData:function(t){this._super(t)},setOtherColXNone:function(){this.otherColX=h.NONE;for(var t=0;t<this.xColPlayer.length;t++){var e=this.xColPlayer[t];e.otherColX!=h.NONE&&e.setOtherColXNone()}},isOtherColX:function(){this.isCheckOtherColX=!0;for(var t=0;t<this.xColPlayer.length;t++){var e=this.xColPlayer[t];if(!1===e.isCheckOtherColX){if(e.collisionX!=h.NONE)return!0;if(e.isOtherColX())return!0}}return!1},setCheckOtherColX:function(t){this.isCheckOtherColX=t;for(var e=0;e<this.xColPlayer.length;e++){var i=this.xColPlayer[e];i.isCheckOtherColX!=t&&i.setCheckOtherColX(t)}},reciveSynPos1:function(t){for(var e=this.m_BufferedState.length-1;e>=1;e--)this.m_BufferedState[e]=this.m_BufferedState[e-1];var i=new r;i.timestamp=t.sTime,console.log("obj.state:"+t.state),i.pos.x=t.x,i.pos.y=t.y,i.direction=t.direction,i.state=t.state,i.vx=t.vx,i.vy=t.vy,this.m_BufferedState[0]=i,this.m_TimestampCount=Math.min(this.m_TimestampCount+1,this.m_BufferedState.length);for(var o=0;o<this.m_TimestampCount-1;o++)this.m_BufferedState[o].timestamp<this.m_BufferedState[o+1].timestamp&&console.log("State inconsistent");this.mLastUpdateTime=Date.now()},reciveSynPos:function(t){var e=new r;e.timestamp=t.sTime,e.pos.x=t.x,e.pos.y=t.y,e.direction=t.direction,e.state=t.state,e.vx=t.vx,e.vy=t.vy,this.bufferQueue.unshift(e),this.mLastUpdateTime=Date.now()},setPos:function(t,e){this._super(t,e),this.position.x=t,this.position.y=e},onCollisionPlayerEnter:function(t,e){var i=t.world.aabb,s=t.world.preAabb.clone(),n=e.world.aabb,r=e.world.preAabb.clone(),c=null;if(c=t.tag===o.CollideType.Hero?t.node.getComponent("HeroControl"):t.node.getComponent("Player"),r.x=n.x,s.x=i.x,console.log("Player onCollisionPlayerEnter this.xCollider.name: "+t.name+" this.curState: "+this.curState+" this.isYDiff(player): "+this.isYDiff(c)+" player.curState:"+c.curState),this.curState===a.ST_WAIT||this.curState===a.ST_BE_PUSHED)c.isMoveOrBePushed()&&0==this.isYDiff(c)&&cc.Intersection.rectRect(r,s)&&(c.getSpeedX()>0&&r.xMax>s.xMax?(this.collisionX===h.COL_RIGHT||this.otherColX===h.COL_RIGHT?c.otherColX=h.COL_RIGHT:this.isBePushedLeft||(this.node.x=-2+i.xMax+n.width/2-this.node.parent.x),this.leftColPlayer=c,this.colPlayerX=h.COL_LEFT,this.isBePushedRight=!0,this.setAddSpX(c.roleId,c.getSpeedX()),this.setState(a.ST_BE_PUSHED)):c.getSpeedX()>0&&r.xMax<s.xMax?c.collisionX!==h.COL_RIGHT&&c.otherColX!==h.COL_RIGHT||(this.node.x=2+i.xMin-n.width/2-this.node.parent.x):c.getSpeedX()<0&&r.xMin<s.xMin?(this.collisionX===h.COL_LEFT||this.otherColX===h.COL_LEFT?c.otherColX=h.COL_LEFT:this.isBePushedRight||(this.node.x=2+i.xMin-n.width/2-this.node.parent.x),this.rightColPlayer=c,this.colPlayerX=h.COL_RIGHT,this.setAddSpX(c.roleId,c.getSpeedX()),this.isBePushedLeft=!0,this.setState(a.ST_BE_PUSHED)):c.getSpeedX()<0&&r.xMin>s.xMin?c.collisionX!==h.COL_LEFT&&c.otherColX!==h.COL_LEFT||(this.node.x=-2+i.xMax+n.width/2-this.node.parent.x):(c.curState===a.ST_WAIT&&r.xMax>s.xMax?(this.setAddSpX(c.roleId,0),this.isBePushedRight=!1):c.curState===a.ST_WAIT&&r.xMin<s.xMin&&(this.setAddSpX(c.roleId,0),this.isBePushedLeft=!1),!1===this.isBePushedLeft&&!1===this.isBePushedRight&&this.setState(a.ST_WAIT)),this.xColPlayerList.push(t),this.xColPlayer.push(c));else if(this.isMove()||this.curState===a.ST_RUN_BE_PUSHED){if(c.isWait()&&0==this.isYDiff(c)){if(cc.Intersection.rectRect(r,s))return this.speed.x<0&&r.xMax>s.xMax?(this.colPlayerX=h.COL_LEFT,this.otherColX===h.COL_LEFT?this.node.x=-2+s.xMax+r.width/2-this.node.parent.x:c.curState===a.ST_BE_PUSHED&&c.isBePushedRight&&(this.node.x=-2+s.xMax+r.width/2-this.node.parent.x)):this.speed.x>0&&r.xMin<s.xMin&&(this.colPlayerX=h.COL_RIGHT,this.otherColX===h.COL_RIGHT?this.node.x=2+s.xMin-r.width/2-this.node.parent.x:c.curState===a.ST_BE_PUSHED&&c.isBePushedLeft&&(this.node.x=2+s.xMin-r.width/2-this.node.parent.x)),this.xColPlayerList.push(t),void this.xColPlayer.push(c)}else if((c.isMove()||c.curState===a.ST_RUN_BE_PUSHED)&&0==this.isYDiff(c)){this.speed.x,c.speed.x;var l=!1;n.xMin<i.xMin?(this.node.x=2+i.xMin-n.width/2-this.node.parent.x,this.direction!=c.direction&&this.direction===this.directionRight&&(l=!0)):n.xMax>i.xMax&&(this.node.x=-2+i.xMax+n.width/2-this.node.parent.x,this.direction!=c.direction&&this.direction===this.directionLeft&&(l=!0)),this.runBePushSpX=0,l&&this.setState(a.ST_RUN_BE_PUSHED),this.xColPlayerList.push(t),this.xColPlayer.push(c)}}else if(c.isJump()&&(r.y=n.y,s.y=i.y,cc.Intersection.rectRect(r,s))){if(this.speed.y<0&&r.yMax>s.yMax)this.node.y=s.yMax-this.node.parent.y,console.log("this.node.y 4: "+this.node.y),this.colPlayerY=h.COL_DOWN,this.setState(a.ST_LAND);else if(this.speed.y>0&&r.yMin<s.yMin){if(this.collisionY===h.COL_DOWN||this.colPlayerY===h.COL_DOWN)return;this.node.y=s.yMin-r.height-this.node.parent.y,console.log("this.node.y 3: "+this.node.y),this.colPlayerY=h.COL_UP}this.yColPlayerList.push(t),this.speed.y=0}},onCollisionWallEnter:function(t,e){var i=t.world.aabb,o=t.world.preAabb.clone(),s=e.world.aabb,n=e.world.preAabb.clone();if(n.x=s.x,o.x=i.x,cc.Intersection.rectRect(n,o))return(this.speed.x<0||this.colPlayerX===h.COL_RIGHT)&&n.xMax>o.xMax?(this.node.x=-2+o.xMax+n.width/2-this.node.parent.x,this.collisionX=h.COL_LEFT,console.log("Player otherPreAabb.xMax:"+o+" selfPreAabb: "+n+" this.node.parent.x: "+this.node.parent.x),console.log("Player:  Collider.name: "+t.name+" this.collisionX: "+this.collisionX+" this.node.x:"+this.node.x)):(this.speed.x>0||this.colPlayerX===h.COL_LEFT)&&n.xMin<o.xMin&&(this.node.x=2+o.xMin-n.width/2-this.node.parent.x,this.collisionX=h.COL_RIGHT,console.log("Player otherPreAabb:"+o+" selfPreAabb: "+n+" this.node.parent.x: "+this.node.parent.x),console.log("Player:  Collider.name: "+t.name+" this.collisionX: "+this.collisionX+" this.node.x:"+this.node.x)),this.xColliderList.push(t),console.log("player onCollisionEnter this.xColliderList.length: "+this.xColliderList.length+" Collider.name: "+t.name+" this.collisionX: "+this.collisionX),void(this.speed.x=0);n.y=s.y,o.y=i.y,cc.Intersection.rectRect(s,i)&&(this.speed.y<0&&s.yMax>i.yMax?(this.node.y=i.yMax-this.node.parent.y,this.collisionY=h.COL_DOWN,console.log("=== selfPreAabb.yMin: "+n.yMin+" otherPreAabb.yMin:"+o.yMin),this.setState(a.ST_LAND)):this.speed.y>0&&s.yMin<i.yMin&&(this.node.y=i.yMin-s.height-this.node.parent.y,this.collisionY=h.COL_UP),this.yColliderList.push(t),this.speed.y=0)},onCollisionEnter:function(t,e){switch(this.aabb=e.world.aabb,t.tag){case o.CollideType.ColorBrick:break;case o.CollideType.Wall:this.onCollisionWallEnter(t,e);break;case o.CollideType.Hero:case o.CollideType.Player:this.onCollisionPlayerEnter(t,e);break;default:this.onCollisionWallEnter(t,e)}},onCollisionPlayerStay:function(t,e){var i=t.world.aabb,s=t.world.preAabb.clone(),n=e.world.aabb,r=e.world.preAabb.clone(),c=null;if(c=t.tag===o.CollideType.Hero?t.node.getComponent("HeroControl"):t.node.getComponent("Player"),r.x=n.x,s.x=i.x,this.curState===a.ST_WAIT||this.curState===a.ST_BE_PUSHED)c.isMoveOrBePushed()&&0==this.isYDiff(c)&&cc.Intersection.rectRect(r,s)&&(c.getSpeedX()>0&&r.xMax>s.xMax?(this.collisionX===h.COL_RIGHT||this.otherColX===h.COL_RIGHT?c.otherColX=h.COL_RIGHT:this.isBePushedLeft||(this.node.x=-2+s.xMax+r.width/2-this.node.parent.x),this.leftColPlayer=c,this.colPlayerX=h.COL_LEFT,this.isBePushedRight=!0,this.setAddSpX(c.roleId,c.getSpeedX()),this.setState(a.ST_BE_PUSHED)):c.getSpeedX()>0&&r.xMax<s.xMax?c.collisionX!==h.COL_RIGHT&&c.otherColX!==h.COL_RIGHT||(this.node.x=2+i.xMin-n.width/2-this.node.parent.x):c.getSpeedX()<0&&r.xMin<s.xMin?(this.collisionX===h.COL_LEFT||this.otherColX===h.COL_LEFT?c.otherColX=h.COL_LEFT:this.isBePushedRight||(this.node.x=2+s.xMin-r.width/2-this.node.parent.x),this.rightColPlayer=c,this.colPlayerX=h.COL_RIGHT,this.isBePushedLeft=!0,this.setAddSpX(c.roleId,c.getSpeedX()),this.setState(a.ST_BE_PUSHED)):c.getSpeedX()<0&&r.xMin>s.xMin?c.collisionX!==h.COL_LEFT&&c.otherColX!==h.COL_LEFT||(this.node.x=-2+i.xMax+n.width/2-this.node.parent.x):c.curState===a.ST_WAIT&&r.xMax>s.xMax?(this.setAddSpX(c.roleId,0),this.isBePushedRight=!1):c.curState===a.ST_WAIT&&r.xMin<s.xMin&&(this.setAddSpX(c.roleId,0),this.isBePushedLeft=!1));else if(this.isMove()||this.curState===a.ST_RUN_BE_PUSHED)if(c.isWait()&&0==this.isYDiff(c)){if(cc.Intersection.rectRect(r,s))return void(this.speed.x<0&&r.xMax>s.xMax?(this.colPlayerX=h.COL_LEFT,this.otherColX===h.COL_LEFT?this.node.x=-2+s.xMax+r.width/2-this.node.parent.x:c.curState===a.ST_BE_PUSHED&&c.isBePushedRight&&(this.node.x=-2+s.xMax+r.width/2-this.node.parent.x)):this.speed.x>0&&r.xMin<s.xMin&&(this.colPlayerX=h.COL_RIGHT,this.otherColX===h.COL_RIGHT?this.node.x=2+s.xMin-r.width/2-this.node.parent.x:c.curState===a.ST_BE_PUSHED&&c.isBePushedLeft&&(this.node.x=2+s.xMin-r.width/2-this.node.parent.x)))}else if((c.isMove()||this.curState===a.ST_RUN_BE_PUSHED)&&0==this.isYDiff(c)){this.speed.x,c.speed.x;var l=!1;c.curState!=a.ST_RUN_BE_PUSHED?n.xMin<i.xMin?(this.node.x=2+i.xMin-n.width/2-this.node.parent.x,this.direction!=c.direction&&this.direction===this.directionRight&&(l=!0)):n.xMax>i.xMax&&(this.node.x=-2+i.xMax+n.width/2-this.node.parent.x,this.direction!=c.direction&&this.direction===this.directionLeft&&(l=!0)):(this.node.x=this.node.x,n.xMin<i.xMin?this.direction!=c.direction&&this.direction===this.directionRight?l=!0:this.node.x=i.xMin-n.width/2-this.node.parent.x:n.xMax>i.xMax&&(this.direction!=c.direction&&this.direction===this.directionLeft?l=!0:this.node.x=i.xMax+n.width/2-this.node.parent.x)),l&&this.setState(a.ST_RUN_BE_PUSHED),this.runBePushSpX=0}},onCollisionStay:function(t,e){switch(t.tag){case o.CollideType.Hero:case o.CollideType.Player:this.onCollisionPlayerStay(t,e)}if(this.collisionY===h.COL_DOWN&&"Platform"===t.node.group){var i=t.node.getComponent("PlatformMotion");i&&(this.node.x+=i._movedDiff)}},onCollisionOtherExit:function(t,e){if(o.removeByValue(this.xColliderList,t)&&this.xColliderList.length<=0){if(this.collisionX===h.COL_LEFT||this.collisionX===h.COL_RIGHT)for(var i=0;i<this.xColPlayer.length;i++){this.xColPlayer[i].setOtherColXNone()}console.log("player onCollisionExit this.xColliderList.length: "+this.xColliderList.length+" Collider.name: "+t.name+" this.xColPlayer.length: "+this.xColPlayer.length),this.collisionX=h.NONE}o.removeByValue(this.yColliderList,t)&&this.yColliderList.length<=0&&(this.collisionY=h.NONE,this.jumping=!0)},onCollisionPlayerExit:function(t,e){t.world.aabb,t.world.preAabb.clone(),e.world.aabb,e.world.preAabb.clone();var i=null;i=t.tag===o.CollideType.Hero?t.node.getComponent("HeroControl"):t.node.getComponent("Player"),this.leftColPlayer&&this.leftColPlayer.roleId===i.roleId&&this.isBePushedRight?(this.setAddSpX(i.roleId,0),this.isBePushedRight=!1,this.leftColPlayer=null):this.rightColPlayer&&this.rightColPlayer.roleId===i.roleId&&this.isBePushedLeft&&(this.setAddSpX(i.roleId,0),this.isBePushedLeft=!1,this.rightColPlayer=null),!1===this.isBePushedLeft&&!1===this.isBePushedRight&&this.curState===a.ST_BE_PUSHED&&this.setState(a.ST_WAIT),o.removeByValue(this.xColPlayerList,t)&&(this.setAddSpX(i.roleId,0),o.removeByValue(this.xColPlayer,i),this.xColPlayerList.length<=0&&(this.colPlayerX=h.NONE),this.isOtherColX()||(this.setOtherColXNone(),this.setCheckOtherColX(!1))),o.removeByValue(this.yColPlayerList,t)&&this.yColPlayerList.length<=0&&(this.colPlayerY=h.NONE)},onCollisionExit:function(t,e){switch(t.tag){case o.CollideType.ColorBrick:break;case o.CollideType.Hero:case o.CollideType.Player:this.onCollisionPlayerExit(t,e);break;default:this.onCollisionOtherExit(t,e)}},correctVx:function(t){return Math.abs(t)>this.maxSpeed.x&&(t=t>0?this.maxSpeed.x:-this.maxSpeed.x),t},correctVy:function(t){return Math.abs(t)>this.maxSpeed.y&&(t=t>0?this.maxSpeed.y:-this.maxSpeed.y),t},setSpeed:function(t,e){this.speed.x=t,this.speed.y=e},setState:function(t){if(this.autoFaceTo(),this.curState!==t&&this.curState!==a.ST_LOSE&&this.curState!==a.ST_WIN){switch(console.log("player newState: "+t+" thi.roleId:"+this.roleId),this._super(t),t){case a.ST_WAIT:this.direction=this.directionIdle,this.preState!=a.ST_BE_PUSHED&&this.spineAnim.idle();break;case a.ST_JUMP:this.spineAnim.jump();break;case a.ST_LAND:this.direction===this.directionIdle?this.setState(a.ST_WAIT):this.setState(a.ST_RUN);break;case a.ST_RUN:this.direction=this.faceDirection,this.spineAnim.run();break;case a.ST_SQUAT:break;case a.ST_BE_PUSHED:this.preState!=a.ST_WAIT&&this.spineAnim.idle();break;case a.ST_FALL:break;case a.ST_WIN:this.spineAnim.win();break;case a.ST_LOSE:this.spineAnim.lose()}this.isCrrectPos=!1}},checkColidePlayer:function(){for(var t=!1,e=0;e<this.xColPlayer.length;e++){var i=this.xColPlayer[e];if((i.otherColX===h.COL_LEFT||i.collisionX===h.COL_LEFT)&&this.collisionX!=h.COL_LEFT)return this.otherColX=h.COL_LEFT,void(t=!0);if((i.otherColX===h.COL_RIGHT||i.collisionX===h.COL_RIGHT)&&this.collisionX!=h.COL_RIGHT)return this.otherColX=h.COL_RIGHT,void(t=!0)}!1===t&&(this.otherColX=h.NONE)},updateState:function(t){this.modify.x=this.node.x-t.pos.x,this.modify.y=this.node.y-t.pos.y;var e=this.modify.mag();return this.position.x=t.pos.x,this.position.y=t.pos.y,e>=1&&t.state===a.ST_WAIT&&this.curState!=a.ST_RUN_BE_PUSHED?e:(this.setSpeed(t.vx,t.vy),this.direction=t.direction,0!=t.direction&&(this.faceDirection=t.direction),this.setState(t.state),e)},update:function(t){this.checkColidePlayer(),this.updateMove(t)},updateMoveInterpTime:function(t){var e=cc.vv.serverTime.getTime()-this.interpolationBackTime;if(0!==this.m_BufferedState[0].timestamp){if(this.m_BufferedState[0].timestamp>e){for(var i=0;i<this.m_TimestampCount;i++)if(this.m_BufferedState[i].timestamp<=e||i==this.m_TimestampCount-1){var o=this.m_BufferedState[Math.max(i-1,0)],s=this.m_BufferedState[i],n=o.timestamp-s.timestamp,r=0;if(n>1e-4&&(r=(e-s.timestamp)/n),r<.5?this.updateState(s):this.updateState(o),this.curState===a.ST_BE_PUSHED)return;return void(this.node.position=s.pos.lerp(o.pos,r))}}else{var h=this.m_BufferedState[0];if(this.updateState(h),this.curState===a.ST_BE_PUSHED)return;this.node.position=h.pos}this.correctPos()}},updateMoveSmInterp:function(t){if(this.curState!==a.ST_WAIT||this.preState==a.ST_WAIT)(this.speed.y*this.collisionY>0||this.speed.y*this.colPlayerY>0)&&(this.speed.y=0),0!=this.speed.y&&(this.speed.y+=this.gravity*t,this.speed.y=this.correctVy(this.speed.y),this.position.y+=this.speed.y*t),(this.speed.x*this.collisionX>0||this.speed.x*this.otherColX>0)&&(this.speed.x=0),0!=this.speed.x&&(this.speed.x=this.correctVx(this.speed.x),this.position.x+=this.speed.x*t),this.modify.x*=1-this.smoothFactor,this.modify.y*=1-this.smoothFactor,this.node.x=this.position.x+this.modify.x,this.node.y=this.position.y+this.modify.y,this.correctPos();else if(!this.isCrrectPos){var e=this.node.getPosition().sub(this.position);console.log(" diff: "+e),Math.abs(e.x)>20?(this.modify.x*=1-this.smoothFactor,this.node.x=this.position.x+this.modify.x):0!=e.y?this.node.y=this.position.y:this.isCrrectPos=!0,console.log(" this.node.getPosition: "+this.node.getPosition()+" this.position:"+this.position)}},lerpToPos:function(t,e){var i=cc.lerp(this.node.x,t.x,20*e),o=cc.lerp(this.node.y,t.y,20*e),s=i-this.node.x,n=o-this.node.y;s=this.correctStepSx(s),n=this.correctStepSy(n),this.node.x+=s,this.node.y+=n},updateMove:function(t){var e=Date.now();if(!(this.bufferQueue.length<=0)){if(this.bufferQueue.length>1){var i=this.bufferQueue.pop(),o=this.updateState(i);if(this.curState===a.ST_BE_PUSHED||this.curState===a.ST_RUN_BE_PUSHED)return;o>150?(console.log("偏差太大，直接跳跃:====="),this.node.x=i.pos.x,this.node.y=i.pos.y,this.modify.x=0,this.modify.y=0):this.lerpToPos(i.pos,t)}else if(e-this.mLastUpdateTime<=200){var s=this.bufferQueue[0],n=this.updateState(s);if(this.curState===a.ST_BE_PUSHED||this.curState===a.ST_RUN_BE_PUSHED)return;n>150?(console.log("偏差太大，直接跳跃:====="),this.node.x=s.pos.x,this.node.y=s.pos.y,this.modify.x=0,this.modify.y=0):this.lerpToPos(s.pos,t)}else{var r=this.bufferQueue[0],h=this.updateState(r);if(this.curState===a.ST_RUN_BE_PUSHED)return;if(this.curState!==r.state&&this.curState!==a.ST_LOSE&&this.curState!==a.ST_WIN||(console.log("this.curState:"+this.curState+" this.roleId:"+this.roleId),this.bufferQueue.pop()),h>150)console.log("偏差太大，直接跳跃:====="),this.node.x=r.pos.x,this.node.y=r.pos.y,this.modify.x=0,this.modify.y=0;else if(0==this.node.position.equals(r.pos)){var c=r.pos.x-this.node.x,l=r.pos.y-this.node.y;c=this.correctStepSx(c),l=this.correctStepSy(l),console.log("sx : "+c),console.log("sy : "+l),this.node.x+=c,this.node.y+=l,console.log(" this.node.position: "+this.node.position+" buf.pos:"+r.pos+" this.roleId:"+this.roleId)}else console.log("buf.pos:"+r.pos+" this.roleId:"+this.roleId)}this.correctPos()}}}),cc._RF.pop()},{Actor:"Actor",ActorConst:"ActorConst",GlobalUtil:"GlobalUtil",NetState:"NetState"}],ResManager:[function(t,e,i){"use strict";cc._RF.push(e,"4ce79VhHlBM+oqs3S6YzDi1","ResManager"),cc.Class({extends:cc.Component,properties:{gameAtlas:{default:null,type:cc.SpriteAtlas},resultAtlas:{default:null,type:cc.SpriteAtlas},roleSpines:{default:[],type:[sp.SkeletonData]},portraits:{default:[],type:[cc.SpriteFrame]},pframe:{default:[],type:[cc.SpriteFrame]},countAudio:{default:null,url:cc.AudioClip,displayName:"倒数音效"},gameOverAudio:{default:null,url:cc.AudioClip,displayName:"游戏结束"},jumpAudio:{default:null,url:cc.AudioClip,displayName:"跳跃音效"},loseAudio:{default:null,url:cc.AudioClip,displayName:"失败音效"},readyGoAudio:{default:null,url:cc.AudioClip,displayName:"开始"},runAudio:{default:null,url:cc.AudioClip,displayName:"走"},winAudio:{default:null,url:cc.AudioClip,displayName:"赢"},gameOverWin:{default:null,url:cc.AudioClip,displayName:"游戏结束赢"},bgAudio:{default:null,url:cc.AudioClip,displayName:"背景音乐"}},onLoad:function(){console.log("onLoad"),cc.loader.loadResDir("Audio",cc.AudioClip,function(t,e){for(var i=0;i<e.length;i++)console.log("audios[i]"+e[i])})},start:function(){console.log("resmangager."),null!=cc.vv&&(cc.vv.resManager=this)},getSpriteFrameByName:function(t){return this.gameAtlas.getSpriteFrame(t)},getSpineSkeletData:function(t){return this.roleSpines[t]},getPortrait:function(t){return this.portraits[t]},getPortraitFrame:function(t){return this.pframe[t]},onDestroy:function(){console.log("onDestroy"),cc.loader.releaseResDir("Audio",cc.AudioClip)}}),cc._RF.pop()},{}],ResultUI:[function(t,e,i){"use strict";cc._RF.push(e,"e5f6a03+KxGHKSFp1clbdU8","ResultUI");var o=t("GlobalUtil"),s=t("ActorConst").ActState;cc.Class({extends:cc.Component,properties:{RankPrefab:{default:null,type:cc.Prefab}},onLoad:function(){console.log("ResultUI onLoad"),this.winAnim=this.node.getChildByName("win").getComponent(cc.Animation),this.loseAnim=this.node.getChildByName("loser").getComponent(cc.Animation),this.drawAnim=this.node.getChildByName("draw").getComponent(cc.Animation),this.zhezhaoAnim=cc.find("zhezhao/zhezhao",this.node).getComponent(cc.Animation);var t=cc.find("root");this.game=t.getComponent("Game"),this.layout=cc.find("Rank/Layout",this.node)},start:function(){console.log("ResultUI start")},sortScore:function(t,e){return t.score===e.score&&t.curState===s.ST_WIN?-1:e.score-t.score},showResult:function(t){this.node.active=!0,t===o.WinType.Win?(this.winAnim.node.active=!0,this.winAnim.play("win"),cc.vv.audioMgr.playSFX(cc.vv.resManager.winAudio)):t===o.WinType.Lose?(this.loseAnim.node.active=!0,this.loseAnim.play("loser"),cc.vv.audioMgr.playSFX(cc.vv.resManager.loseAudio)):(this.drawAnim.node.active=!0,this.drawAnim.play("draw"),cc.vv.audioMgr.playSFX(cc.vv.resManager.loseAudio)),this.zhezhaoAnim.play("zhezhao"),this.setRank()},setRank:function(){this.game.players.sort(this.sortScore);for(var t=0;t<this.game.players.length;++t){var e=this.game.players[t],i=cc.instantiate(this.RankPrefab);i.parent=this.layout,i.getChildByName("LbScore").getComponent(cc.Label).string=e.score,i.getChildByName("SpPortrait").getComponent(cc.Sprite).spriteFrame=cc.vv.resManager.getPortrait(e.resId),i.getComponent(cc.Sprite).spriteFrame=cc.vv.resManager.getPortraitFrame(t);var o=i.getChildByName("winFlag");e.curState===s.ST_WIN&&(o.active=!0)}}}),cc._RF.pop()},{ActorConst:"ActorConst",GlobalUtil:"GlobalUtil"}],"SHA-1":[function(t,e,i){"use strict";cc._RF.push(e,"e99d1++9xpCir9/Jh/Pxu8V","SHA-1");var o=0;function s(t){return function(t){for(var e=o?"0123456789ABCDEF":"0123456789abcdef",i="",s=0;s<4*t.length;s++)i+=e.charAt(t[s>>2]>>8*(3-s%4)+4&15)+e.charAt(t[s>>2]>>8*(3-s%4)&15);return i}(function(t){for(var e=t,i=Array(80),o=1732584193,s=-271733879,h=-1732584194,c=271733878,l=-1009589776,d=0;d<e.length;d+=16){for(var u=o,p=s,m=h,f=c,y=l,g=0;g<80;g++){i[g]=g<16?e[d+g]:a(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);var S=r(r(a(o,5),n(g,s,h,c)),r(r(l,i[g]),(_=g)<20?1518500249:_<40?1859775393:_<60?-1894007588:-899497514));l=c,c=h,h=a(s,30),s=o,o=S}o=r(o,u),s=r(s,p),h=r(h,m),c=r(c,f),l=r(l,y)}var _;return new Array(o,s,h,c,l)}(function(t){for(var e=1+(t.length+8>>6),i=new Array(16*e),o=0;o<16*e;o++)i[o]=0;for(o=0;o<t.length;o++)i[o>>2]|=t.charCodeAt(o)<<24-8*(3&o);return i[o>>2]|=128<<24-8*(3&o),i[16*e-1]=8*t.length,i}(t)))}function n(t,e,i,o){return t<20?e&i|~e&o:t<40?e^i^o:t<60?e&i|e&o|i&o:e^i^o}function r(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function a(t,e){return t<<e|t>>>32-e}e.exports={hex_sha1:s},cc._RF.pop()},{}],ServerTime:[function(t,e,i){"use strict";cc._RF.push(e,"382d26zISJLZ4nvPLfvFIGc","ServerTime"),cc.Class({extends:cc.Component,properties:{clientSendTime:0,dtS2CTime:0},refreshServerTime:function(t){var e=Date.now(),i=new Date(t).getTime();this.dtS2CTime=i-e+0},refreshSendTime:function(){this.clientSendTime=Date.now()},getTime:function(){return Date.now()}}),cc._RF.pop()},{}],ShaderUtils:[function(t,e,i){"use strict";cc._RF.push(e,"f53cdY2ZCdOtYn/ZjBiiKBE","ShaderUtils");var o={shaderPrograms:{},setShader:function(e,i){var o=this.shaderPrograms[i];if(!o){o=new cc.GLProgram;var s=t(cc.js.formatStr("%s.vert",i)),n=t(cc.js.formatStr("%s.frag",i));cc.sys.isNative?o.initWithString(s,n):(o.initWithVertexShaderByteArray(s,n),o.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),o.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),o.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS)),o.link(),o.updateUniforms(),this.shaderPrograms[i]=o}return e._sgNode.setShaderProgram(o),o}};e.exports=o,cc._RF.pop()},{}],SimpleMotion:[function(t,e,i){"use strict";cc._RF.push(e,"fde33rWt81MvZWO7QQ3jv3j","SimpleMotion"),cc.Class({extends:cc.Component,properties:{moveSpeed:100,rotationSpeed:90},onLoad:function(){},update:function(t){this.node.x+=t*this.moveSpeed,this.node.rotation+=t*this.rotationSpeed}}),cc._RF.pop()},{}],SpineAnim:[function(t,e,i){"use strict";cc._RF.push(e,"7c6e2CR9DBFP5MFxkQawwl+","SpineAnim"),cc.Class({extends:cc.Component,editor:{requireComponent:sp.Skeleton},properties:{mixTime:.3},onLoad:function(){var t=this;this.walkAnim="walk",this.runAnim="walk",this.jumpAnim="jump",this.idleAnim="stand",this.shootAnim="shoot",this.winAnim="win",this.loseAnim="lose";var e=this.spine=this.getComponent("sp.Skeleton");this._setMix(this.walkAnim,this.runAnim),this._setMix(this.runAnim,this.jumpAnim),this._setMix(this.walkAnim,this.jumpAnim),this._setMix(this.walkAnim,this.idleAnim),this._setMix(this.runAnim,this.idleAnim),this._setMix(this.jumpAnim,this.idleAnim),this._setMix(this.jumpAnim,this.loseAnim),this._setMix(this.idleAnim,this.loseAnim),this._setMix(this.runAnim,this.loseAnim),this._setMix(this.jumpAnim,this.winAnim),this._setMix(this.idleAnim,this.winAnim),this._setMix(this.runAnim,this.winAnim),e.setStartListener(function(t){t.animation&&t.animation.name}),e.setInterruptListener(function(t){t.animation&&t.animation.name}),e.setEndListener(function(t){t.animation&&t.animation.name}),e.setDisposeListener(function(t){t.animation&&t.animation.name}),e.setCompleteListener(function(e,i){(e.animation?e.animation.name:"")===t.shootAnim&&t.spine.clearTrack(1)}),e.setEventListener(function(t,e){t.animation&&t.animation.name}),this._hasStop=!1},setSkeletonData:function(t){this.spine.skeletonData=t},toggleDebugSlots:function(){this.spine.debugSlots=!this.spine.debugSlots},toggleDebugBones:function(){this.spine.debugBones=!this.spine.debugBones},toggleTimeScale:function(){1===this.spine.timeScale?this.spine.timeScale=.3:this.spine.timeScale=1},stop:function(){this.spine.clearTrack(0),this._hasStop=!0},walk:function(){this.spine.setAnimation(0,this.walkAnim,!0),this._hasStop=!1},run:function(){this.spine.setAnimation(0,this.runAnim,!0),this._hasStop=!1},jump:function(){this.spine.animation;this.spine.setAnimation(0,this.jumpAnim,!1)},shoot:function(){this.spine.setAnimation(1,this.shootAnim,!1)},idle:function(){console.log("this.idleAnim:"+this.idleAnim),this.spine.setAnimation(0,this.idleAnim,!0)},lose:function(){this.spine.setAnimation(0,this.loseAnim,!0)},win:function(){this.spine.setAnimation(0,this.winAnim,!0)},_setMix:function(t,e){this.spine.setMix(t,e,this.mixTime),this.spine.setMix(e,t,this.mixTime)}}),cc._RF.pop()},{}],Status:[function(t,e,i){"use strict";cc._RF.push(e,"27b68YQbidFhoWHAoUx93IA","Status"),cc.Class({extends:cc.Component,properties:{},start:function(){this.red=new cc.Color(205,0,0),this.green=new cc.Color(0,205,0),this.yellow=new cc.Color(255,200,0);var t=cc.find("root");this.game=t.getComponent("Game"),this.lbMs=this.node.getComponent(cc.Label)},update:function(t){cc.vv.gameNetMgr.delayMS&&this.game.isStart()?(cc.vv.gameNetMgr.lastSendTime>cc.vv.gameNetMgr.lastRecieveTime&&cc.vv.gameNetMgr.lastSendTime-cc.vv.gameNetMgr.lastRecieveTime>=1080&&(cc.vv.gameNetMgr.delayMS=cc.vv.gameNetMgr.lastSendTime-cc.vv.gameNetMgr.lastRecieveTime),this.lbMs.string=cc.vv.gameNetMgr.delayMS+"ms",cc.vv.gameNetMgr.delayMS>800?this.lbMs.node.color=this.red:cc.vv.gameNetMgr.delayMS>100?this.lbMs.node.color=this.yellow:this.lbMs.node.color=this.green):(this.lbMs.string="N/A",this.lbMs.node.color=this.red)}}),cc._RF.pop()},{}],TestShader1:[function(t,e,i){"use strict";cc._RF.push(e,"858436rGu1F+btBifYsWgh5","TestShader1");var o="\nattribute vec4 a_position;\n attribute vec2 a_texCoord;\n attribute vec4 a_color;\n varying vec2 v_texCoord;\n varying vec4 v_fragmentColor;\n void main()\n {\n     gl_Position = CC_PMatrix  * a_position;\n     v_fragmentColor = a_color;\n     v_texCoord = a_texCoord;\n }\n",s="\nvarying vec4 v_fragmentColor; // vertex shader传入，setColor设置的颜色  \nvarying vec2 v_texCoord; // 纹理坐标  \nuniform vec2 outlineSize; // 描边宽度，以像素为单位  \nuniform vec3 outlineColor; // 描边颜色  \nuniform vec3 foregroundColor; // 主要用于字体，可传可不传，不传默认为白色  \n// 判断在这个角度上距离为outlineSize那一点是不是透明  \nint getIsStrokeWithAngel(float cosangel, float sinangel)  \n{  \n    int stroke = 0;  \n    float a = texture2D(CC_Texture0, vec2(v_texCoord.x + outlineSize.x * cosangel, v_texCoord.y + outlineSize.y * sinangel)).a; // 这句比较难懂，outlineSize * cos(rad)可以理解为在x轴上投影，除以textureSize.x是因为texture2D接收的是一个0~1的纹理坐标，而不是像素坐标  \n    if (a >= 0.5)// 我把alpha值大于0.5都视为不透明，小于0.5都视为透明  \n    {  \n        stroke = 1;  \n    }  \n    return stroke;  \n}  \n  \nvoid main()  \n{  \n    vec4 myC = texture2D(CC_Texture0, vec2(v_texCoord.x, v_texCoord.y)); // 正在处理的这个像素点的颜色  \n    myC.rgb *= foregroundColor;  \n    if (myC.a >= 0.5) // 不透明，不管，直接返回  \n    {  \n        gl_FragColor = v_fragmentColor * myC;  \n        return;  \n    }  \n    // 这里肯定有朋友会问，一个for循环就搞定啦，怎么这么麻烦！其实我一开始也是用for的，但后来在安卓某些机型（如小米4）会直接崩溃，查找资料发现OpenGL es并不是很支持循环，while和for都不要用  \n    int strokeCount = 0;  \n    strokeCount += getIsStrokeWithAngel( 1.0, 0.0);//0  \n    strokeCount += getIsStrokeWithAngel( 0.9659258262, 0.2588190451);//15  \n    strokeCount += getIsStrokeWithAngel( 0.8660254037, 0.5);//30  \n    strokeCount += getIsStrokeWithAngel( 0.7071067811, 0.7071067811);//45  \n    strokeCount += getIsStrokeWithAngel( 0.5, 0.8660254037);//60  \n    strokeCount += getIsStrokeWithAngel( 0.2588190451, 0.9659258262);//75  \n    strokeCount += getIsStrokeWithAngel( 0.0, 1.0);//90  \n    strokeCount += getIsStrokeWithAngel(-0.2588190451, 0.9659258262);//105  \n    strokeCount += getIsStrokeWithAngel(-0.5, 0.8660254037);//120  \n    strokeCount += getIsStrokeWithAngel(-0.7071067811, 0.7071067811);//135  \n    strokeCount += getIsStrokeWithAngel(-0.8660254037, 0.5);//150  \n    strokeCount += getIsStrokeWithAngel(-0.9659258262, 0.2588190451);//165  \n    strokeCount += getIsStrokeWithAngel(-1.0, 0.0);//180  \n    strokeCount += getIsStrokeWithAngel(-0.9659258262, -0.2588190451);//195  \n    strokeCount += getIsStrokeWithAngel(-0.8660254037, -0.5);//210  \n    strokeCount += getIsStrokeWithAngel(-0.7071067811, -0.7071067811);//225  \n    strokeCount += getIsStrokeWithAngel(-0.5, -0.8660254037);//240  \n    strokeCount += getIsStrokeWithAngel(-0.2588190451, -0.9659258262);//255  \n    strokeCount += getIsStrokeWithAngel(0.0, -1.0);//270  \n    strokeCount += getIsStrokeWithAngel(0.2588190451, -0.9659258262);//285  \n    strokeCount += getIsStrokeWithAngel(0.5, -0.8660254037);//300  \n    strokeCount += getIsStrokeWithAngel(0.7071067811, -0.7071067811);//315  \n    strokeCount += getIsStrokeWithAngel(0.8660254037, -0.5);//330  \n    strokeCount += getIsStrokeWithAngel(0.9659258262, -0.2588190451);//345  \n  \n    if (strokeCount > 0) // 四周围至少有一个点是不透明的，这个点要设成描边颜色  \n    {  \n        myC.rgb = outlineColor;  \n        myC.a = 1.0;  \n    }  \n  \n    gl_FragColor = v_fragmentColor * myC;  \n}  \n";cc.Class({extends:cc.Component,properties:{threshold:{default:1.75,type:cc.Float},radius:{default:0,type:cc.Float},colorR:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorG:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorB:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},previewId:{default:null,editorOnly:!0,visible:!1},_program:{default:null,visible:!1}},editor:{requireComponent:cc.Sprite,executeInEditMode:!0},onLoad:function(){this.render(this.threshold,this.radius,this.colorR,this.colorG,this.colorB,!1)},onDestroy:function(){null!=this.previewId&&clearInterval(this.previewId),this.threshold=this.radius=this.colorR=this.colorG=this.colorB=0,this.render(0,0,0,0,0,!1)},render:function(t,e,i,n,r,a){if(console.log("colorR:"+i+" colorG:"+i+" colorB:"+r),this._program||(this._program=new cc.GLProgram),cc.sys.isNative){this._program.initWithString(o,s),this._program.link(),this._program.updateUniforms();var h=cc.GLProgramState.getOrCreateWithGLProgram(this._program);h.setUniformFloat("u_threshold",t),h.setUniformVec3("u_outlineColor",{x:i/255,y:n/255,z:r/255}),h.setUniformFloat("u_radius",e)}else this._program.initWithVertexShaderByteArray(o,s),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),this._program.link(),this._program.updateUniforms(),this._program.setUniformLocationWith2f(this._program.getUniformLocationForName("outlineSize"),.06,.06),this._program.setUniformLocationWith3f(this._program.getUniformLocationForName("outlineColor"),i/255,n/255,r/255),this._program.setUniformLocationWith3f(this._program.getUniformLocationForName("foregroundColor"),1,1,1);this.setProgram(this.node._sgNode,this._program,a)},setProgram:function(t,e,i){if(cc.sys.isNative){var o=cc.GLProgramState.getOrCreateWithGLProgram(e);t.setGLProgramState(o)}else t.setShaderProgram(e);var s=t.children;if(s)for(var n=0;n<s.length;n++)this.setProgram(s[n],e)}}),cc._RF.pop()},{}],TestShader:[function(t,e,i){"use strict";cc._RF.push(e,"8f1f7T3XWlBbK3fGuLs8xDj","TestShader");var o="\nattribute vec4 a_position;\n attribute vec2 a_texCoord;\n attribute vec4 a_color;\n varying vec2 v_texCoord;\n varying vec4 v_fragmentColor;\n void main()\n {\n     gl_Position = CC_PMatrix  * a_position;\n     v_fragmentColor = a_color;\n     v_texCoord = a_texCoord;\n }\n",s="\nvarying vec4 v_fragmentColor; // vertex shader传入，setColor设置的颜色  \nvarying vec2 v_texCoord; // 纹理坐标  \nuniform vec2 outlineSize; // 描边宽度，以像素为单位  \nuniform vec3 outlineColor; // 描边颜色  \nuniform vec3 foregroundColor; // 主要用于字体，可传可不传，不传默认为白色  \n// 判断在这个角度上距离为outlineSize那一点是不是透明  \nint getIsStrokeWithAngel(float cosangel, float sinangel)  \n{  \n    int stroke = 0;  \n    float a = texture2D(CC_Texture0, vec2(v_texCoord.x + outlineSize.x * cosangel, v_texCoord.y + outlineSize.y * sinangel)).a; // 这句比较难懂，outlineSize * cos(rad)可以理解为在x轴上投影，除以textureSize.x是因为texture2D接收的是一个0~1的纹理坐标，而不是像素坐标  \n    if (a >= 0.5)// 我把alpha值大于0.5都视为不透明，小于0.5都视为透明  \n    {  \n        stroke = 1;  \n    }  \n    return stroke;  \n}  \n  \nvoid main()  \n{  \n    vec4 myC = texture2D(CC_Texture0, vec2(v_texCoord.x, v_texCoord.y)); // 正在处理的这个像素点的颜色  \n    myC.rgb *= foregroundColor;  \n    if (myC.a >= 0.5) // 不透明，不管，直接返回  \n    {  \n        gl_FragColor = v_fragmentColor * myC;  \n        return;  \n    }  \n    // 这里肯定有朋友会问，一个for循环就搞定啦，怎么这么麻烦！其实我一开始也是用for的，但后来在安卓某些机型（如小米4）会直接崩溃，查找资料发现OpenGL es并不是很支持循环，while和for都不要用  \n    int strokeCount = 0;  \n    strokeCount += getIsStrokeWithAngel( 1.0, 0.0);//0  \n    strokeCount += getIsStrokeWithAngel( 0.9659258262, 0.2588190451);//15  \n    strokeCount += getIsStrokeWithAngel( 0.8660254037, 0.5);//30  \n    strokeCount += getIsStrokeWithAngel( 0.7071067811, 0.7071067811);//45  \n    strokeCount += getIsStrokeWithAngel( 0.5, 0.8660254037);//60  \n    strokeCount += getIsStrokeWithAngel( 0.2588190451, 0.9659258262);//75  \n    strokeCount += getIsStrokeWithAngel( 0.0, 1.0);//90  \n    strokeCount += getIsStrokeWithAngel(-0.2588190451, 0.9659258262);//105  \n    strokeCount += getIsStrokeWithAngel(-0.5, 0.8660254037);//120  \n    strokeCount += getIsStrokeWithAngel(-0.7071067811, 0.7071067811);//135  \n    strokeCount += getIsStrokeWithAngel(-0.8660254037, 0.5);//150  \n    strokeCount += getIsStrokeWithAngel(-0.9659258262, 0.2588190451);//165  \n    strokeCount += getIsStrokeWithAngel(-1.0, 0.0);//180  \n    strokeCount += getIsStrokeWithAngel(-0.9659258262, -0.2588190451);//195  \n    strokeCount += getIsStrokeWithAngel(-0.8660254037, -0.5);//210  \n    strokeCount += getIsStrokeWithAngel(-0.7071067811, -0.7071067811);//225  \n    strokeCount += getIsStrokeWithAngel(-0.5, -0.8660254037);//240  \n    strokeCount += getIsStrokeWithAngel(-0.2588190451, -0.9659258262);//255  \n    strokeCount += getIsStrokeWithAngel(0.0, -1.0);//270  \n    strokeCount += getIsStrokeWithAngel(0.2588190451, -0.9659258262);//285  \n    strokeCount += getIsStrokeWithAngel(0.5, -0.8660254037);//300  \n    strokeCount += getIsStrokeWithAngel(0.7071067811, -0.7071067811);//315  \n    strokeCount += getIsStrokeWithAngel(0.8660254037, -0.5);//330  \n    strokeCount += getIsStrokeWithAngel(0.9659258262, -0.2588190451);//345  \n  \n    if (strokeCount > 0) // 四周围至少有一个点是不透明的，这个点要设成描边颜色  \n    {  \n        myC.rgb = outlineColor;  \n        myC.a = 1.0;  \n    }  \n  \n    gl_FragColor = v_fragmentColor * myC;  \n}  \n";cc.Class({extends:cc.Component,properties:{threshold:{default:1.75,type:cc.Float},radius:{default:0,type:cc.Float},colorR:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorG:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorB:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},previewId:{default:null,editorOnly:!0,visible:!1},_program:{default:null,visible:!1}},editor:{executeInEditMode:!0},onLoad:function(){this.spine=this.getComponent("sp.Skeleton");this.render(this.threshold,this.radius,this.colorR,this.colorG,this.colorB,!1)},onFocusInEditor:function(){null!=this.previewId&&clearInterval(this.previewId);var t=this;this.previewId=setInterval(function(){t.render(t.threshold,t.radius,t.colorR,t.colorG,t.colorB,!1)},1/60)},onLostFocusInEditor:function(){null!=this.previewId&&clearInterval(this.previewId)},onDestroy:function(){null!=this.previewId&&clearInterval(this.previewId),this.threshold=this.radius=this.colorR=this.colorG=this.colorB=0,this.render(0,0,0,0,0,!1)},render:function(t,e,i,n,r,a){if(console.log("colorR:"+i+" colorG:"+i+" colorB:"+r),this._program||(this._program=new cc.GLProgram),cc.sys.isNative){this._program.initWithString(o,s),this._program.link(),this._program.updateUniforms();var h=cc.GLProgramState.getOrCreateWithGLProgram(this._program);h.setUniformFloat("u_threshold",t),h.setUniformVec3("outlineColor",{x:i/255,y:n/255,z:r/255}),h.setUniformFloat("u_radius",e)}else this._program.initWithVertexShaderByteArray(o,s),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),this._program.link(),this._program.updateUniforms(),this._program.setUniformLocationWith2f(this._program.getUniformLocationForName("outlineSize"),.001,.001),this._program.setUniformLocationWith3f(this._program.getUniformLocationForName("outlineColor"),i/255,n/255,r/255),this._program.setUniformLocationWith3f(this._program.getUniformLocationForName("foregroundColor"),1,1,1);this.setProgram(this.spine._sgNode,this._program,a)},setProgram:function(t,e,i){if(cc.sys.isNative){var o=cc.GLProgramState.getOrCreateWithGLProgram(e);t.setGLProgramState(o)}else t.setShaderProgram(e);var s=t.children;if(s)for(var n=0;n<s.length;n++)this.setProgram(s[n],e)}}),cc._RF.pop()},{}],TouchTest:[function(t,e,i){"use strict";cc._RF.push(e,"a6a9dNOcJhKg46HJQxNdui8","TouchTest"),cc.Class({extends:cc.Component,properties:{arrowNode:{default:null,type:cc.Node,displayName:"箭头"},arrow2Node:{default:null,type:cc.Node,displayName:"箭头2"}},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.moveDis=cc.v2(0,0),this.startPos=cc.v2(-365,-374),this.arrowNode.setPosition(this.startPos),this.curLength=473},_touchStartEvent:function(t){console.log("this.startPos: "+this.startPos)},_touchMoveEvent:function(t){this.movePos=this.node.convertToNodeSpaceAR(t.getLocation()),this.moveDis.x=this.movePos.x-this.startPos.x,this.moveDis.y=this.movePos.y-this.startPos.y;var e=this.moveDis.mag(),i=e/this.curLength;this.arrowNode.height=e*i+50;var o=cc.v2(0,this.arrowNode.height);this.arrow2Node.setPosition(o),this._angle=90-Math.atan2(this.movePos.y-this.startPos.y,this.movePos.x-this.startPos.x)*(180/Math.PI),console.log("this._angle: "+this._angle),this.arrowNode.rotation=this._angle}}),cc._RF.pop()},{}],Wall:[function(t,e,i){"use strict";cc._RF.push(e,"1a279oXNoxFFI516fswAbVo","Wall");var o=cc.Enum({Left:0,Right:1,Top:2,Bottom:3});cc.Class({extends:cc.Component,properties:{type:{default:o.Left,type:o},width:5},start:function(){var t=this.getComponent(cc.BoxCollider);if(t){var e=this.node,i=this.type;console.log("type : "+i);var s=cc.winSize.width,n=cc.winSize.height;console.log("width : "+s+" height: "+n);var r=this.width;i===o.Left?(e.height=n,e.width=r,e.x=0,e.y=n/2):i===o.Right?(e.height=n,e.width=r,e.x=s,e.y=n/2):i===o.Top?(e.width=s,e.height=r,e.x=s/2,e.y=n):i===o.Bottom&&(e.width=s,e.height=r,e.x=s/2,e.y=0),t.size=e.getContentSize()}}}),cc._RF.pop()},{}],YYSdk:[function(t,e,i){"use strict";cc._RF.push(e,"17659tC4exL4J9wBaHxsw48","YYSdk"),cc.Class({extends:cc.Component,QueryTimeStamp:function(){var t=this.getUrlParam("timestamp");return console.log("timestamp : "+t),t},QueryNonstr:function(){var t=this.getUrlParam("nonstr");return console.log("nonstr : "+t),t},QuerySign:function(){var t=this.getUrlParam("sign");return console.log("QuerySign : "+t),t},QueryPost_data:function(){var t=this.getUrlParam("post_data");return console.log("QueryPost_data : "+t),t},analyseUrlParams:function(){var t=window.decodeURIComponent;this.params={};var e=cc.sys.isNative?window.nativeApp.gameInfo.gurl:window.location.href;if(e.length<100&&cc.vv.netConfig&&(e+=cc.vv.netConfig.getUrlParams()),e){console.log("analyseUrlParams href :"+e);var i=e.slice(e.indexOf("?")+1).split("&post_data"),o=i[0].split("&");o.push("post_data"+i[1]);for(var s=-1,n=void 0,r=o.length,a=0;a<r;a++)if(-1!==(s=(n=o[a]).indexOf("="))){var h=t(n.substr(0,s)),c=t(n.slice(s+1));if(!h)continue;this.params[h]=c||null}}},getUrlParam:function(t){return this.params?this.params[t]:null},createWSUrl:function(){var t=this.getUrlParam("wsscheme"),e=this.getUrlParam("websocketdomain"),i=this.getUrlParam("port"),o=this.getUrlParam("sign"),s=this.getUrlParam("nonstr"),n=this.getUrlParam("timestamp"),r=this.getUrlParam("post_data"),a=JSON.parse(r),h=t+"://"+e+":"+i+"/"+a.gameid+"/"+a.roomid+"?nonstr="+s+"&sign="+o+"&timestamp="+n+"&post_data="+r;return console.log("ws_url:"+h),h},printMsg:function(t){try{logInfo(t)}catch(e){console.warn("logInfo()未定义"),console.log("printMsg:"+t)}},getLoadingProgress:function(){return loadprogress},updateLoadingBarProgress:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){try{t=getLoadingProgress()+t,updateLoadingBarProgress(t)}catch(t){this.printMsg("更新loadingError！！！")}}),gameLoadingFinish:function(){try{console.log("gameCloseLoading"),this.gameCloseLoading(),console.log("window.nativeApp.onPKFinishLoading"),window.nativeApp.onPKFinishLoading("{}")}catch(t){this.printMsg("Game.js--gameLoadingFinish()---error")}},gameCloseLoading:function(){try{closeLoadingC()}catch(t){this.printMsg("closeLoadingC---error")}},gamePKStart:function(){try{console.log("window.nativeApp.onPKStart"),window.nativeApp.onPKStart("{}")}catch(t){console.log("游戏开始异常！！！")}},reportResult:function(t){try{this.printMsg("window.nativeApp.onPKFinish--result:"+t),window.nativeApp.onPKFinish(t),this.printMsg("上报游戏结果---")}catch(e){try{window.parent.postMessage(t,"*"),this.printMsg("上报游戏结果---纯网页---")}catch(t){this.printMsg("上报游戏结果异常！！！")}}},onPKExceptionFinish:function(){try{window.nativeApp.onPKExceptionFinish("{}"),this.printMsg("游戏非正常结束---")}catch(t){this.printMsg("游戏非正常结束异常！！！")}},onSSystemRResult:function(t){this.reportResult(t)}}),cc._RF.pop()},{}],ZIndex:[function(t,e,i){"use strict";cc._RF.push(e,"7fe46Zaq1JLDbaBsAOvJzaU","ZIndex"),cc.Class({extends:cc.Component,properties:{zIndex:0},onLoad:function(){this.node.zIndex=this.zIndex}}),cc._RF.pop()},{}],csvjson:[function(t,e,i){"use strict";cc._RF.push(e,"b17a7cqljdOXJ2jvF0UkURU","csvjson");var o={};(function(){function t(t){return void 0!==t}function e(t,e){for(var i,o=t.split(e=e||","),s=o.length-1;s>=0;s--)'"'==o[s].replace(/"\s+$/,'"').charAt(o[s].length-1)?(i=o[s].replace(/^\s+"/,'"')).length>1&&'"'==i.charAt(0)?o[s]=o[s].replace(/^\s*"|"\s*$/g,"").replace(/""/g,'"'):s?o.splice(s-1,2,[o[s-1],o[s]].join(e)):o=o.shift().split(e).concat(o):o[s].replace(/""/g,'"');return o}o.csv2json=function(i,o){var s=t((o=o||{}).delim)?o.delim:",",n=!t(o.header)||o.header;i.replace(/\x0A\x0D/g,"\n").replace(/\x0D/g,"\n");var r=i.split("\n"),a=e(r[0],s),h=e(r[1],s),c=e(r[2],s),l=r.slice(3,r.length);if(!n)for(var d=0;d<a.length;d++)a[d]=d;var u={};for(var p in u.headers=a,u.valTypes=h,u.descs=c,u.rows=[],l)if(l.hasOwnProperty(p)){var m=l[p];if(0==m.length)break;var f=e(m,s),y={};for(var d in f)if(f.hasOwnProperty(d)){var g=f[d];isNaN(1*g)||(g*=1),y[a[d]]=g}u.rows.push(y)}return u},o.csv2array=function(i,o){var s=t((o=o||{}).delim)?o.delim:",",n=!t(o.header)||o.header;i.replace(/\x0A\x0D/g,"\n").replace(/\x0D/g,"\n");var r=i.split("\n"),a=r.slice(3,r.length);if(!n)for(var h=0;h<csvheaders.length;h++)csvheaders[h]=h;var c=[];for(var l in a)if(a.hasOwnProperty(l)){var d=a[l];if(0==d.length)break;var u=e(d,s),p=[];for(var h in u)if(u.hasOwnProperty(h)){var m=u[h];isNaN(1*m)||(m*=1),p.push(m)}c.push(p)}return c},o.json2csv=function(e,i){var o=t((i=i||{}).delim)?i.delim:",",s=t(i.textdelim)?i.textdelim:"";if("string"==typeof e)return null;var n="";for(var r in e.headers){if(e.headers.hasOwnProperty(r))n+=s+(c=e.headers[r])+s+o}for(var a in n=n.slice(0,n.length-1),n+="\n",e.rows)if(e.rows.hasOwnProperty(a)){var h=e.rows[a];for(var r in e.headers){var c;if(e.headers.hasOwnProperty(r))n+="string"==typeof h[c=e.headers[r]]?s+h[c]+s+o:h[c]+o}n=n.slice(0,n.length-1),n+="\n"}return n=n.slice(0,n.length-1)}})(),e.exports={csv2json:o.csv2json,csv2array:o.csv2array},cc._RF.pop()},{}],"gray.frag":[function(t,e,i){"use strict";cc._RF.push(e,"55dbbtnrE5J6aGCwZ5uYsvf","gray.frag"),e.exports="\n#ifdef GL_ES\nprecision lowp float;\n#endif\n\nvarying vec4 v_fragmentColor; // vertex shader传入，setColor设置的颜色\nvarying vec2 v_texCoord; // 纹理坐标\nuniform float outlineSize; // 描边宽度，以像素为单位\nuniform vec3 outlineColor; // 描边颜色\nuniform vec2 textureSize; // 纹理大小（宽和高），为了计算周围各点的纹理坐标，必须传入它，因为纹理坐标范围是0~1\n\n// 判断在这个角度上距离为outlineSize那一点是不是透明\nint getIsStrokeWithAngel(float angel)\n{\n    int stroke = 0;\n    float rad = angel * 0.01745329252; // 这个浮点数是 pi / 180，角度转弧度\n    vec2 unit = 1.0 / textureSize.xy;//单位坐标\n    vec2 offset = vec2(outlineSize * cos(rad) * unit.x, outlineSize * sin(rad) * unit.y); //偏移量\n    float a = texture2D(CC_Texture0, v_texCoord + offset).a;\n    if (a >= 0.5)// 我把alpha值大于0.5都视为不透明，小于0.5都视为透明\n    {\n        stroke = 1;\n    }\n    return stroke;\n}\n\nvoid main()\n{\n    // vec4 c = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n    // gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b);\n    // gl_FragColor.w = c.w;\n    // return;\n\n    vec4 myC = texture2D(CC_Texture0, v_texCoord); // 正在处理的这个像素点的颜色\n    if (myC.a >= 0.5) // 不透明，不管，直接返回\n    {\n        gl_FragColor = v_fragmentColor * myC;\n        return;\n    }\n    // 这里肯定有朋友会问，一个for循环就搞定啦，怎么这么麻烦！其实我一开始也是用for的，但后来在安卓某些机型（如小米4）会直接崩溃，查找资料发现OpenGL es并不是很支持循环，while和for都不要用\n    int strokeCount = 0;\n    strokeCount += getIsStrokeWithAngel(0.0);\n    strokeCount += getIsStrokeWithAngel(30.0);\n    strokeCount += getIsStrokeWithAngel(60.0);\n    strokeCount += getIsStrokeWithAngel(90.0);\n    strokeCount += getIsStrokeWithAngel(120.0);\n    strokeCount += getIsStrokeWithAngel(150.0);\n    strokeCount += getIsStrokeWithAngel(180.0);\n    strokeCount += getIsStrokeWithAngel(210.0);\n    strokeCount += getIsStrokeWithAngel(240.0);\n    strokeCount += getIsStrokeWithAngel(270.0);\n    strokeCount += getIsStrokeWithAngel(300.0);\n    strokeCount += getIsStrokeWithAngel(330.0);\n\n    if (strokeCount > 0) // 四周围至少有一个点是不透明的，这个点要设成描边颜色\n    {\n        myC.rgb = outlineColor;\n        myC.a = 1.0;\n    }\n\n    gl_FragColor = v_fragmentColor * myC;\n}\n",cc._RF.pop()},{}],"gray.vert":[function(t,e,i){"use strict";cc._RF.push(e,"62b20yr3kJNZIWIu8Kl5nFj","gray.vert"),e.exports="\nattribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;\n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}\n",cc._RF.pop()},{}],outline:[function(t,e,i){"use strict";cc._RF.push(e,"267817YOYlDA4pXROuwdb+d","outline");var o="\nattribute vec4 a_position;\n attribute vec2 a_texCoord;\n attribute vec4 a_color;\n varying vec2 v_texCoord;\n varying vec4 v_fragmentColor;\n void main()\n {\n     gl_Position = CC_PMatrix  * a_position;\n     v_fragmentColor = a_color;\n     v_texCoord = a_texCoord;\n }\n",s="\nvarying vec2 v_texCoord;\nvarying vec4 v_fragmentColor;\n\nuniform vec3 u_outlineColor;\nuniform float u_threshold;\nuniform float u_radius;\n\nvoid main()\n{\n    float radius = u_radius;\n    vec4 accum = vec4(0.0);\n    vec4 normal = vec4(0.0);\n    \n    normal = texture2D(CC_Texture0, vec2(v_texCoord.x, v_texCoord.y));\n    \n    accum += texture2D(CC_Texture0, vec2(v_texCoord.x - radius, v_texCoord.y - radius));\n    accum += texture2D(CC_Texture0, vec2(v_texCoord.x + radius, v_texCoord.y - radius));\n    accum += texture2D(CC_Texture0, vec2(v_texCoord.x + radius, v_texCoord.y + radius));\n    accum += texture2D(CC_Texture0, vec2(v_texCoord.x - radius, v_texCoord.y + radius));\n    \n    accum *= u_threshold;\n    accum.rgb = u_outlineColor * accum.a;\n    accum.a = 0.0;\n    normal = ( accum * (1.0 - normal.a)) + (normal * normal.a);\n    \n    gl_FragColor = v_fragmentColor * normal;\n}\n";cc.Class({extends:cc.Component,properties:{threshold:{default:1.75,type:cc.Float},radius:{default:0,type:cc.Float},colorR:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorG:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},colorB:{default:0,type:cc.Integer,range:[0,255,1],slide:!0},previewId:{default:null,editorOnly:!0,visible:!1},_program:{default:null,visible:!1}},editor:{executeInEditMode:!0},onLoad:function(){this.spine=this.getComponent("sp.Skeleton");this.render(this.threshold,this.radius,this.colorR,this.colorG,this.colorB,!1)},onFocusInEditor:function(){null!=this.previewId&&clearInterval(this.previewId);var t=this;this.previewId=setInterval(function(){t.render(t.threshold,t.radius,t.colorR,t.colorG,t.colorB,!1)},1/60)},onLostFocusInEditor:function(){null!=this.previewId&&clearInterval(this.previewId)},onDestroy:function(){null!=this.previewId&&clearInterval(this.previewId),this.threshold=this.radius=this.colorR=this.colorG=this.colorB=0,this.render(0,0,0,0,0,!1)},render:function(t,e,i,n,r,a){if(this._program||(this._program=new cc.GLProgram),cc.sys.isNative){this._program.initWithString(o,s),this._program.link(),this._program.updateUniforms();var h=cc.GLProgramState.getOrCreateWithGLProgram(this._program);h.setUniformFloat("u_threshold",t),h.setUniformVec3("u_outlineColor",{x:i/255,y:n/255,z:r/255}),h.setUniformFloat("u_radius",e)}else this._program.initWithVertexShaderByteArray(o,s),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),this._program.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),this._program.link(),this._program.updateUniforms(),this._program.setUniformLocationWith1f(this._program.getUniformLocationForName("u_threshold"),t),this._program.setUniformLocationWith3f(this._program.getUniformLocationForName("u_outlineColor"),i/255,n/255,r/255),this._program.setUniformLocationWith2f(this._program.getUniformLocationForName("u_radius"),e);this.setProgram(this.spine._sgNode,this._program,a)},setProgram:function(t,e,i){if(cc.sys.isNative){var o=cc.GLProgramState.getOrCreateWithGLProgram(e);t.setGLProgramState(o)}else t.setShaderProgram(e);var s=t.children;if(s)for(var n=0;n<s.length;n++)this.setProgram(s[n],e)}}),cc._RF.pop()},{}]},{},["gray.frag","gray.vert","Actor","ActorConst","BrickColor","HeroControl","NetState","Player","Wall","SpineAnim","AppStart","AudioMgr","csvjson","DataStream","Game","GameConfig","Game_mo","GlobalConfig","Joystick","JoystickCommon","JoystickNode","Map","GameNetMgr","Net","NetConfig","ResManager","YYSdk","TestShader","TestShader1","outline","TouchTest","GameBg","GameUI","ResultUI","Status","CameraControl","Dictionary","GlobalUtil","MathUtil","PlatformMotion","SHA-1","ServerTime","ShaderUtils","SimpleMotion","ZIndex"]);